<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Dynamically swap for mobile/desktop -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Likes vs dislikes Better</title>
  <!-- Google 2025 Material Symbols Outlined -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <style>
    /* ========== BASE + RESET ========== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      transition: background-color 0.3s, color 0.3s;
      overflow-wrap: break-word;
      word-wrap: break-word;
      word-break: normal;
      font-size: 16px;
      line-height: 1.5;
      position: relative;
    }
    h1, h2, h3 { margin-bottom: 10px; }
    
    /* ========== DARK MODE ========== */
    body.dark-mode { background-color: #222; color: #eee; }
    body.dark-mode .sidebar { background-color: #111; color: #ccc; }
    body.dark-mode .topbar { background-color: #000; }
    body.dark-mode .content { background-color: #333; color: #eee; }
    body.dark-mode .btn { background-color: #444; }
    body.dark-mode .btn:hover { background-color: #555; }
    body.dark-mode .mobile-footer { background-color: #111; color: #ccc; }
    body.dark-mode .darken-overlay { background-color: rgba(0,0,0,0.7); }
    body.dark-mode .box { background-color: #444; color: #eee; }
    body.dark-mode .video-player-ui { background-color: #555; color: #eee; }

    body.dark-mode table.video-table th {
      background: #555; 
      color: #fff;
    }
    body.dark-mode table.video-table td {
      background: #444;
      color: #eee;
    }
    
    /* ========== OVERLAY BACKDROP ========== */
    .darken-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.3);
      z-index: 1500;
      pointer-events: none;
    }
    .darken-overlay.active { display: block; }
    
    /* ========== TOPBAR ========== */
    .topbar {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 60px;
      background-color: #2a2a2a;
      color: #fff;
      padding: 0 20px;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .search-container {
      display: flex;
      align-items: center;
      background-color: #3a3a3a;
      padding: 5px 10px;
      border-radius: 24px;
      min-width: 239px;
      transition: width 0.3s;
    }
    .search-container input {
      background-color: transparent;
      border: none;
      color: #fff;
      font-size: 16px;
      outline: none;
      flex: 1;
    }
    .search-container span {
      cursor: pointer;
      font-size: 24px;
      color: #ccc;
      margin-left: 5px;
    }
    .topbar-right {
      position: absolute;
      right: 20px;
      top: 0;
      display: flex;
      align-items: center;
      gap: 10px;
      height: 60px;
    }
    #historyIcon { cursor: pointer; font-size: 24px; line-height: 60px; }
    .toggle-icon { cursor: pointer; display: inline-flex; align-items: center; gap: 5px; line-height: 60px; }
    #searchIconMobile { display: none; cursor: pointer; font-size: 24px; line-height: 60px; }
    
    .create-button-wrapper { position: relative; }
    .create-btn {
      border-radius: 30px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 5px 10px;
    }
    .create-menu {
      position: absolute;
      top: 45px;
      right: 0;
      display: none;
      background-color: #2a2a2a;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 5px 0;
      min-width: 160px;
      z-index: 5000;
    }
    .create-menu div {
      padding: 8px 16px;
      cursor: pointer;
      color: #fff;
      white-space: nowrap;
    }
    .create-menu div:hover { background-color: #444; }
    
    .search-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0;
      background-color: #2a2a2a;
      height: 60px;
      z-index: 1500;
      padding: 0 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .search-overlay input {
      flex: 1;
      padding: 8px 12px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      outline: none;
    }
    .search-overlay .close-search { cursor: pointer; font-size: 24px; }
    
    /* ========== SIDEBAR ========== */
    .sidebar {
      position: fixed;
      top: 60px;
      left: 0; bottom: 0;
      width: 200px;
      background-color: #3a3a3a;
      color: #ddd;
      padding-top: 10px;
      overflow-y: auto;
      transition: width 0.3s;
      z-index: 2000;
      font-size: 16px;
    }
    .sidebar .material-symbols-outlined { font-size: 28px; }
    .sidebar .menu-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: inline; }
    .sidebar.collapsed { width: 60px; }
    .sidebar.collapsed .menu-text { display: none; }
    .sidebar.open-overlay {
      position: fixed;
      top: 0; left: 0; bottom: 0;
      width: 240px;
      background-color: #3a3a3a;
      z-index: 2001;
      transform: translateX(0);
      padding-top: 60px;
    }
    .sidebar.open-overlay .menu-text { display: inline; }
    .sidebar-overlay-close {
      display: none;
      position: absolute;
      top: 15px; right: 15px;
      font-size: 28px;
      cursor: pointer;
      color: #fff;
    }
    
    /* ========== CONTENT ========== */
    .content {
      margin-top: 60px;
      margin-left: 200px;
      padding: 20px;
      transition: margin-left 0.3s, background-color 0.3s, color 0.3s;
      overflow-y: auto;
      z-index: 1;
    }
    .sidebar.collapsed ~ .content { margin-left: 60px; }
    .page { display: none; }
    #homeContent { display: block; }
    
    /* HOME 3-COLUMN */
    .home-container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .home-left, .home-middle, .home-right {
      flex: 1 1 300px;
      max-width: 499px;
      min-width: 173px;
      background: #fff;
      padding: 20px;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: background-color 0.3s, color 0.3s;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .box {
      background: #fff;
      border-radius: 4px;
      padding: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    /* ========== BUTTONS (Rounded) ========== */
    .btn {
      padding: 10px 15px;
      background-color: #2a2a2a;
      color: #fff;
      border: none;
      border-radius: 30px;
      margin: 5px 0;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: background-color 0.3s;
      font-size: 16px;
    }
    .btn:hover { background-color: #444; }
    
    /* ========== MOBILE FOOTER ========== */
    .mobile-footer {
      display: none;
      position: fixed;
      bottom: 0; left: 0; right: 0;
      height: 60px;
      background-color: #3a3a3a;
      color: #fff;
      justify-content: space-around;
      align-items: center;
      z-index: 2002;
    }
    .mobile-footer div {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
    }
    .mobile-footer .material-symbols-outlined { font-size: 28px; }
    
    /* ========== SEARCH RESULTS PAGE ========== */
    #searchResultsContent { padding: 20px; }
    
    /* ========== BUBBLE ========== */
    .bubble {
      position: fixed;
      bottom: 0;
      border-radius: 50%;
      background-color: rgba(66,135,245,0.7);
      animation: floatBubble 4s ease-in-out forwards;
      z-index: 9999;
    }
    @keyframes floatBubble {
      from { transform: translateY(0); opacity: 1; }
      to { transform: translateY(-100vh); opacity: 0; }
    }
    
    @media (max-width: 600px) { #bubblesToggle { display: none !important; } }
    
    /* ========== RESPONSIVE WIDTHS FOR SEARCH BOX ========== */
    @media (min-width: 1201px) {
      .search-container { width: 777px; }
    }
    @media (max-width: 1200px) {
      .search-container { width: 700px; }
    }
    @media (max-width: 1150px) {
      .search-container { width: 675px; }
    }
    @media (max-width: 1120px) {
      .search-container { width: 650px; }
    }
    @media (max-width: 1100px) {
      .search-container { width: 640px; }
    }
    @media (max-width: 1080px) {
      .search-container { width: 633px; }
    }
    @media (max-width: 1060px) {
      .search-container { width: 625px; }
    }
    @media (max-width: 1040px) {
      .search-container { width: 610px; }
    }
    @media (max-width: 1020px) {
      .search-container { width: 605px; }
    }
    @media (max-width: 1000px) {
      .search-container { width: 575px; }
    }
    @media (max-width: 970px) {
      .search-container { width: 550px; }
    }
    @media (max-width: 940px) {
      .search-container { width: 525px; }
    }
    @media (max-width: 920px) {
      .search-container { width: 510px; }
    }
    @media (max-width: 890px) {
      .search-container { width: 475px; }
    }
    @media (max-width: 860px) {
      .search-container { width: 450px; }
    }
    @media (max-width: 840px) {
      .search-container { width: 440px; }
    }
    @media (max-width: 830px) {
      .search-container { width: 433px; }
    }
    @media (max-width: 820px) {
      .search-container { width: 425px; }
    }
    @media (max-width: 800px) {
      .search-container { width: 410px; }
    }
    @media (max-width: 780px) {
      .search-container { width: 400px; }
    }
    @media (max-width: 760px) {
      .search-container { width: 375px; }
    }
    @media (max-width: 755px) {
      .search-container { width: 350px; }
    }
    @media (max-width: 750px) {
      .search-container { width: 325px; }
    }
    @media (max-width: 745px) {
      .search-container { width: 275px; }
    }
    @media (max-width: 740px) {
      .search-container { width: 250px; }
    }
    @media (max-width: 715px) {
      .search-container { width: 225px; }
    }
    @media (max-width: 710px) {
      .search-container { width: 175px; }
    }
    @media (max-width: 705px) {
      .search-container { width: 150px; }
    }
    @media (max-width: 700px) {
      .search-container { width: 125px; }
    }
    @media (max-width: 690px) {
      .search-container { width: 100px; }
    }
    @media (max-width: 680px) {
      .search-container input { display: none; }
      .search-container {
        width: 100px;
        justify-content: center;
      }
      #searchIconMobile { display: block; }
      #searchIcon { display: none; }
      .toggle-icon .toggle-text { display: none; }
    }
    
    @media (max-width: 1211px) {
      .sidebar:not(.open-overlay) { width: 60px; }
      .sidebar:not(.open-overlay) .menu-text { display: none; }
      .sidebar.open-overlay { width: 240px; }
      .sidebar.open-overlay .menu-text { display: inline; }
      .content { margin-left: 60px; }
    }
    @media (max-width: 410px) {
      .sidebar { display: none; }
      .content { margin-left: 0; }
      .mobile-footer { display: flex; }
      .home-container { flex-direction: column; }
    }
    
    /* MODALS */
    .modal {
      display: none;
      position: fixed;
      z-index: 3000;
      left: 50%; top: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 400px;
      background-color: #fff;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      padding: 20px;
    }
    .modal.dark-mode { background-color: #444; color: #fff; }
    .modal-content { position: relative; }
    .modal-content .close {
      position: absolute; right: 10px; top: 10px;
      font-size: 24px; cursor: pointer;
    }
    .modal h2 { margin-bottom: 15px; }
    .modal input[type="text"],
    .modal input[type="file"],
    .modal select {
      width: 100%; padding: 8px;
      margin-bottom: 10px; border: 1px solid #ccc;
      border-radius: 4px;
    }
    .purple-button {
      background-color: purple;
      color: #fff;
      border-radius: 30px;
      padding: 6px 12px;
      border: none;
      cursor: pointer;
      margin-right: 10px;
    }
    .purple-button:hover { opacity: 0.9; }
    .video-player-ui {
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      background: #fafafa;
    }
    
    /* FULLSCREEN OVERLAY */
    #videoFullscreenOverlay {
      display: none;
      position: fixed;
      z-index: 9999;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9);
      justify-content: center;
      align-items: center;
    }
    .overlay-content {
      position: relative;
      width: 100%;
      height: 100%;
      background: #000;
      border-radius: 0;
      overflow: hidden;
    }
    #fullscreenVideo {
      width: 100%;
      height: 100%;
      background: #000;
      object-fit: cover;
      display: block;
    }
    #fullscreenCloseBtn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      font-size: 24px;
      color: #fff;
      cursor: pointer;
      background: rgba(0,0,0,0.4);
      padding: 4px 8px;
      border-radius: 4px;
    }
    .fs-controls {
      position: absolute;
      top: 10px; left: 10px;
      color: #fff;
    }
    
    /* Additional Attach File Button */
    .attach-label {
      display: inline-block;
      background-color: #2a2a2a;
      color: #fff;
      padding: 8px 12px;
      border-radius: 30px;
      cursor: pointer;
      margin-bottom: 10px;
      text-align: center;
    }

    /* NOTIFICATIONS DROPDOWN & BADGE */
    .notifications-icon {
      position: relative;
      cursor: pointer;
      font-size: 24px;
      line-height: 60px;
    }
    #notificationsBadge {
      position: absolute;
      top: -5px; 
      right: -5px;
      background-color: red;
      color: #fff;
      border-radius: 50%;
      padding: 1px 5px;
      font-size: 10px;
      display: none;
    }
    .notifications-dropdown {
      position: absolute;
      right: 0;
      top: 60px;
      background-color: #2a2a2a;
      color: #fff;
      min-width: 250px;
      border: 1px solid #ddd;
      border-radius: 6px;
      z-index: 2001;
      max-height: 300px;
      overflow-y: auto;
      display: none;
    }
    .notifications-dropdown p {
      margin: 0;
      padding: 8px;
      border-bottom: 1px solid #444;
      word-break: break-all;
    }
    .notifications-dropdown p:last-child {
      border-bottom: none;
    }

    /* VIDEO LIST & GRID */
    #videosContent #videoDisplayOptions {
      margin-bottom: 10px;
    }
    #videoList.grid-mode .video-item {
      border: 1px solid #ccc;
      margin: 10px 0;
      padding: 10px;
      border-radius: 4px;
    }
    table.video-table {
      width: 100%;
      border-collapse: collapse;
    }
    table.video-table th,
    table.video-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
      vertical-align: middle;
    }
    /* When width is small, truncate table headers */
    @media (max-width: 600px) {
      table.video-table th,
      table.video-table td {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
    }
    table.video-table th {
      background: #f0f0f0;
    }
    .video-actions button { margin-right: 5px; }

    /* NEW: FILTER BUTTONS + "MORE" ICON DROPDOWN */
    .video-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
      align-items: center;
    }
    .more-icon-wrapper {
      position: relative;
    }
    #moreFiltersBtn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    #moreFiltersDropdown {
      display: none;
      position: absolute;
      top: 45px;
      left: 0;
      background-color: #2a2a2a;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 5px 0;
      min-width: 140px;
      z-index: 9999;
    }
    #moreFiltersDropdown button {
      width: 100%;
      text-align: left;
      border-radius: 0;
      margin: 0;
      padding: 8px 16px;
      background: none;
      border: none;
      color: #fff;
      font-size: 14px;
    }
    #moreFiltersDropdown button:hover {
      background-color: #444;
    }
    .hidden-filter-btn { display: none !important; }
    
    /* NEW: TRUNCATION UTILITY */
    .truncate {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    /* NEW: Home box headers truncation */
    .home-container .box h3 {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* NEW: Custom Theme Setup - now applies to topbar, sidebar, and content */
    :root {
      --custom-theme-color: #2a2a2a;
    }
    body.custom-theme .topbar,
    body.custom-theme .sidebar,
    body.custom-theme .content,
    body.custom-theme .btn,
    body.custom-theme .create-btn {
      background-color: var(--custom-theme-color) !important;
    }
  </style>
</head>
<body>
  <!-- Dark overlay for sidebar -->
  <div class="darken-overlay" id="darkenOverlay"></div>

  <!-- Search Overlay -->
  <div class="search-overlay" id="searchOverlay" style="display: none;">
    <input type="text" id="searchOverlayInput" class="truncate" placeholder="Search for Comments, Photos, Videos, Public Comments, History and More" />
    <span class="material-symbols-outlined" id="searchOverlayIcon">search</span>
    <span class="material-symbols-outlined close-search" id="closeSearchOverlay">close</span>
  </div>
  
  <!-- SIDEBAR -->
  <div class="sidebar" id="sidebar">
    <span class="material-symbols-outlined sidebar-overlay-close" id="sidebarOverlayClose">close</span>
    <div id="sidebarToggle">
      <span class="material-symbols-outlined">menu</span>
    </div>
    <ul>
      <li data-url="home">
        <span class="material-symbols-outlined">home</span>
        <span class="menu-text">Home</span>
      </li>
      <li data-url="check">
        <span class="material-symbols-outlined">check_circle</span>
        <span class="menu-text">Check %</span>
      </li>
      <li data-url="comments">
        <span class="material-symbols-outlined">comment</span>
        <span class="menu-text">Comments</span>
      </li>
      <li data-url="chatAI">
        <span class="material-symbols-outlined">smart_toy</span>
        <span class="menu-text">Chat AI</span>
      </li>
      <li data-url="photos">
        <span class="material-symbols-outlined">photo</span>
        <span class="menu-text">Photos</span>
      </li>
      <li data-url="videos">
        <span class="material-symbols-outlined">movie</span>
        <span class="menu-text">Videos</span>
      </li>
      <li data-url="likesvsdislikes">
        <span class="material-symbols-outlined">thumb_up</span>
        <span class="menu-text">Likes vs Dislikes</span>
      </li>
      <li data-url="settings" style="margin-top: auto; padding-top: 20px;">
        <span class="material-symbols-outlined">settings</span>
        <span class="menu-text">Settings</span>
      </li>
    </ul>
  </div>
  
  <!-- TOPBAR -->
  <div class="topbar">
    <div class="search-container" id="topbarSearchContainer">
      <input type="text" id="searchInput" class="truncate" placeholder="Search for Comments, Photos, Videos, Public Comments, History and More" />
      <span class="material-symbols-outlined" id="searchIcon">search</span>
    </div>
    <div class="topbar-right">
      <span class="material-symbols-outlined" id="searchIconMobile">search</span>
      
      <div class="create-button-wrapper">
        <button class="btn create-btn" id="createButton">
          <span class="material-symbols-outlined">add</span> <span class="truncate">Create</span>
        </button>
        <div class="create-menu" id="createMenu">
          <div onclick="openUploadVideoModal()">Upload Video</div>
          <div onclick="openNewPhotoModal()">Create Photo</div>
          <div onclick="openCreateChannelModal()">Create Channel</div>
          <div onclick="showPage('privateCommentsContent')">Create Private Comment</div>
          <div onclick="showPage('publicCommentsContent')">Create Public Comment</div>
        </div>
      </div>

      <!-- Notifications Icon & Badge -->
      <span class="material-symbols-outlined notifications-icon" id="notificationsIcon">
        notifications
        <span id="notificationsBadge" style="display: none;"></span>
      </span>
      <div class="notifications-dropdown" id="notificationsDropdown"><p>No notifications</p></div>
      <!-- End notifications -->

      <span class="material-symbols-outlined" id="historyIcon">history</span>
    </div>
  </div>
  
  <!-- MOBILE FOOTER -->
  <div class="mobile-footer" id="mobileFooter">
    <div data-url="home">
      <span class="material-symbols-outlined">home</span>
      <small>Home</small>
    </div>
    <div data-url="check">
      <span class="material-symbols-outlined">check_circle</span>
      <small>Check %</small>
    </div>
    <div data-url="comments">
      <span class="material-symbols-outlined">comment</span>
      <small>Comments</small>
    </div>
    <div data-url="chatAI">
      <span class="material-symbols-outlined">smart_toy</span>
      <small>Chat AI</small>
    </div>
    <div data-url="likesvsdislikes">
      <span class="material-symbols-outlined">thumb_up</span>
      <small>Likes</small>
    </div>
    <div data-url="settings">
      <span class="material-symbols-outlined">settings</span>
      <small>Settings</small>
    </div>
  </div>
  
  <!-- MAIN CONTENT -->
  <div class="content">
    <!-- HOME PAGE -->
    <div id="homeContent" class="page">
      <h1>Home</h1>
      <div class="home-container">
        <div class="home-left">
          <div class="box" id="boxPrivateComments">
            <h2>Private Comments list</h2>
            <div id="homePrivateComments">
              <p>No Content Available.</p>
            </div>
          </div>
          <div class="box" id="boxHistory">
            <h2>History</h2>
            <div id="homeHistory">
              <p>No Content Available.</p>
            </div>
          </div>
          <div class="box" id="boxChatAIHistory">
            <h2>Chat AI Message History</h2>
            <div id="homeChatAIHistory">
              <p>No Content Available.</p>
            </div>
          </div>
          <div class="box" id="boxChannelWarnings">
            <h2>Channel Warnings</h2>
            <div id="homeChannelWarnings">
              <p>No Content Available.</p>
            </div>
          </div>
        </div>
        
        <div class="home-middle">
          <div class="box" id="boxChannelsList">
            <h2>Channels List</h2>
            <div id="homeChannelsList">
              <p>No Content Available.</p>
            </div>
          </div>
          <div class="box" id="boxPhotosList">
            <h2>Photos List</h2>
            <div id="homePhotosList">
              <p>No Content Available.</p>
            </div>
          </div>
        </div>
        
        <div class="home-right">
          <div class="box" id="boxCreateTools">
            <button class="btn" onclick="showPage('publicCommentsContent')">
              <span class="material-symbols-outlined">public</span> <span class="truncate">Go to Public Comments</span>
            </button>
            <button class="btn" onclick="showPage('privateCommentsContent')">
              <span class="material-symbols-outlined">note_add</span> <span class="truncate">Create Private Comment</span>
            </button>
            <button class="btn" onclick="showPage('likesVsDislikesContent')">
              <span class="material-symbols-outlined">thumb_up</span> <span class="truncate">Go to Likes vs Dislikes</span>
            </button>
            <button class="btn" onclick="showPage('photosContent')">
              <span class="material-symbols-outlined">photo</span> <span class="truncate">Go to Photos</span>
            </button>
            <button class="btn" onclick="showPage('videosContent')">
              <span class="material-symbols-outlined">movie</span> <span class="truncate">Go to Videos</span>
            </button>
          </div>
          <div class="box" id="boxVideosListRight">
            <h2>Videos List</h2>
            <div id="homeVideosListRight">
              <p>No Content Available.</p>
            </div>
          </div>
          <!-- Creator Inside Box -->
          <div class="box" id="boxCreatorInside">
            <h2>Creator Inside</h2>
            <p>We have made the website better for you by adding filters, grid view and list view, a preview video for fullscreen, notifications, an updated responsive search box with truncation for smaller screens, and a changelog. Any questions or suggestions? Click the contact button.</p>
            <button class="btn" onclick="window.open('https://mail.google.com/mail/u/0/?fs=1&tf=cm&source=mailto&to=minecraftgamer97529@gmail.com', '_blank')">Contact</button>

           <h2>Known Issues<h2>
           <p>When show dislike progress bar and % it only shows progress bar.  Video list view overflows when using smaller device<p>
          </div>
        </div>
      </div>
      <!-- Changelog Box -->
      <div class="box" id="boxChangelog">
        <h2>Changelog</h2>
        <ul>
          <li><strong>1.00</strong> Created</li>
          <li><strong>1.01</strong> Added Bubbles</li>
          <li><strong>1.02</strong> Renamed Public Comments to Comments with names</li>
          <li><strong>1.10</strong> Replaced Search UI with a topbar Search box for smaller screens, added new Google icons and mobile site</li>
          <li><strong>1.11</strong> Fixed the Search box default open on all screen sizes; added the Creator Inside box in the home-right</li>
          <li><strong>1.12</strong> Added box for home</li>
          <li><strong>1.13</strong> Changed the Placeholder in the Search box to "Search for Comments and history"</li>
          <li><strong>1.20</strong> Made the home box dark mode and added Photos and Videos</li>
          <li><strong>1.21</strong> Added a Create button and changed the buttons to rounded</li>
          <li><strong>1.22</strong> Added more home boxes and moved the bubbles toggle from topbar to settings</li>
          <li><strong>1.23</strong> Made the Home better</li>
          <li><strong>1.30</strong> Added Notifications</li>
          <li><strong>1.31</strong> Moved the right topbar icons and added grid view and list view on video</li>
          <li><strong>1.32</strong> Added Filters</li>
          <li><strong>1.33</strong> Updated the zooming/sliding and width of the search box and filters</li>
          <li><strong>1.40</strong> Added Creator Inside, applied text truncation on video list view headers (in list view), on home h3 boxes, on Private Comments list and Chat AI History text, and on the search box placeholder; also updated the custom theme so it applies to the topbar, left sidebar, and content.</li>
          <li><strong>1.41</strong> Changed the placeholder of the search box to "Search for Photos, Comments, Videos, Public Comments and More" </li>
        </ul>
      </div>
      <!-- NEW: Custom Theme Option in Settings is available below -->
    </div>
    
    <!-- CHECK % PAGE -->
    <div id="checkContent" class="page">
      <h1>Check %</h1>
      <form id="checkForm">
        <label>Likes: <input type="number" id="checkLikes" required /></label>
        <label>Dislikes: <input type="number" id="checkDislikes" required /></label>
        <button type="submit" class="btn">
          <span class="material-symbols-outlined">send</span> Submit
        </button>
      </form>
      <div id="checkResult" style="margin-top:20px;"></div>
      <h2>History</h2>
      <div id="checkHistory"></div>
    </div>
    
    <!-- PRIVATE COMMENTS PAGE -->
    <div id="privateCommentsContent" class="page">
      <h1>Private Comments</h1>
      <button class="btn" onclick="showPage('publicCommentsContent')">
        <span class="material-symbols-outlined">public</span> Go to Public Comments
      </button>
      <hr />
      <form id="privateCommentForm">
        <input type="text" id="privateCommentInput" placeholder="Enter your private comment" required />
        <button type="submit" class="btn">
          <span class="material-symbols-outlined">send</span> Post Comment
        </button>
      </form>
      <div id="privateCommentsList"></div>
    </div>
    
    <!-- PUBLIC COMMENTS PAGE -->
    <div id="publicCommentsContent" class="page">
      <h1>Public Comments</h1>
      <form id="publicCommentForm">
        <input type="text" id="publicCommentName" placeholder="Your Name" required />
        <input type="text" id="publicCommentInput" placeholder="Enter your comment" required />
        <button type="submit" class="btn" onclick="saveData()">
          <span class="material-symbols-outlined">post_add</span> Post
        </button>
      </form>
      <div id="publicCommentsList"></div>
    </div>
    
    <!-- CHAT AI PAGE -->
    <div id="chatAIContent" class="page">
      <h1>Chat AI</h1>
      <div class="chatai-container">
        <div class="chatai-messages" id="chatAIMessages"></div>
        <div class="chatai-input">
          <input type="text" id="chatAIInput" placeholder="Ask AI..." />
          <button class="btn" id="chatAISend">
            <span class="material-symbols-outlined">send</span> Send
          </button>
        </div>
      </div>
    </div>
    
    <!-- PHOTOS PAGE -->
    <div id="photosContent" class="page">
      <h1>Photos</h1>
      <button class="btn" style="float:right; margin-bottom:10px;" onclick="openNewPhotoModal()">
        <span class="material-symbols-outlined">add</span> New Photo
      </button>
      <div style="clear:both;"></div>
      <div id="photosList"></div>
    </div>
    
    <!-- VIDEOS PAGE -->
    <div id="videosContent" class="page">
      <h1>Videos</h1>
      <div id="videoDisplayOptions">
        <label for="channelsDropdown">Channels:</label>
        <select id="channelsDropdown"></select>
        
        <button class="btn" onclick="openCreateChannelModal()">
          <span class="material-symbols-outlined">add</span> Create Channel
        </button>
        
        <!-- Toggle grid or list view -->
        <label style="margin-left:20px;">
          <input type="radio" name="videoView" value="grid" checked /> Grid View
        </label>
        <label style="margin-left:10px;">
          <input type="radio" name="videoView" value="list" /> List View
        </label>
        
        <button class="btn" onclick="openUploadVideoModal()" style="margin-left:20px;">
          <span class="material-symbols-outlined">add</span> Upload Video
        </button>
      </div>

      <!-- NEW FILTER BUTTONS ROW -->
      <div class="video-filters" id="videoFilters">
        <!-- Each button has data-filter=... for identification -->
        <button class="btn filter-btn" data-filter="all">All</button>
        <button class="btn filter-btn" data-filter="removed">Removed</button>
        <button class="btn filter-btn" data-filter="public">Public</button>
        <button class="btn filter-btn" data-filter="private">Private</button>
        <button class="btn filter-btn" data-filter="moreLikes">Has More Likes</button>
        <button class="btn filter-btn" data-filter="moreDislikes">Has More Dislikes</button>
        <button class="btn filter-btn" data-filter="same">Same Likes/Dislikes</button>
        <button class="btn filter-btn" data-filter="moneyOn">Money On</button>
        <button class="btn filter-btn" data-filter="moneyOff">Money Off</button>

        <!-- "More" icon + dropdown, used as screen narrows or "zoom" grows -->
        <div class="more-icon-wrapper">
          <button id="moreFiltersBtn" class="btn">
            <span class="material-symbols-outlined">more_horiz</span>
          </button>
          <div id="moreFiltersDropdown" class="create-menu" style="left:0;"></div>
        </div>
      </div>

      <div id="videoList" style="margin-top: 20px;"></div>
    </div>
    
    <!-- LIKES vs DISLIKES PAGE -->
    <div id="likesVsDislikesContent" class="page">
      <h1>Likes vs Dislikes</h1>
      <div id="lvdControls">
        <button class="btn lvd-btn" data-multiplier="1" data-type="like">
          <span class="material-symbols-outlined">thumb_up</span> Like
        </button>
        <button class="btn lvd-btn" data-multiplier="1" data-type="dislike">
          <span class="material-symbols-outlined">thumb_down</span> Dislike
        </button>
        <button class="btn lvd-btn" data-multiplier="2" data-type="like">
          <span class="material-symbols-outlined">thumb_up</span> Like x2
        </button>
        <button class="btn lvd-btn" data-multiplier="2" data-type="dislike">
          <span class="material-symbols-outlined">thumb_down</span> Dislike x2
        </button>
        <button class="btn lvd-btn" data-multiplier="100" data-type="like">
          <span class="material-symbols-outlined">thumb_up</span> Like x100
        </button>
        <button class="btn lvd-btn" data-multiplier="100" data-type="dislike">
          <span class="material-symbols-outlined">thumb_down</span> Dislike x100
        </button>
        <button class="btn lvd-btn" data-multiplier="1000" data-type="like">
          <span class="material-symbols-outlined">thumb_up</span> Like x1000
        </button>
        <button class="btn lvd-btn" data-multiplier="1000" data-type="dislike">
          <span class="material-symbols-outlined">thumb_down</span> Dislike x1000
        </button>
      </div>
      <form id="lvdForm" style="margin-top: 20px;">
        <select id="lvdType">
          <option value="like">Like</option>
          <option value="dislike">Dislike</option>
        </select>
        <input type="number" id="lvdInput" placeholder="Enter amount" required />
        <button type="submit" class="btn">
          <span class="material-symbols-outlined">send</span> Submit
        </button>
      </form>
      <div id="lvdResult" style="margin-top: 20px;"></div>
    </div>
    
    <!-- SETTINGS PAGE -->
    <div id="settingsContent" class="page">
      <h1>Settings</h1>
      <div class="toggle-label">
        <input type="checkbox" id="toggleDarkMode" />
        <span class="material-symbols-outlined">dark_mode</span> Dark Mode
      </div>
      <div class="toggle-label">
        <input type="checkbox" id="toggleMobileSite" />
        <span class="material-symbols-outlined">phone_iphone</span> Mobile Site
      </div>
      <div class="toggle-label">
        <input type="checkbox" id="toggleShowDislike" />
        <span class="material-symbols-outlined">thumb_down</span> Show Dislike Progress &amp; %
      </div>
      <div class="toggle-label">
        <input type="checkbox" id="toggleHideDecimals" />
        <span class="material-symbols-outlined">percent</span> Hide Decimals in Percentages
      </div>
      <div class="toggle-label">
        <input type="checkbox" id="toggleBubbles" />
        <span class="material-symbols-outlined">bubble_chart</span> Bubbles
      </div>
      <!-- NEW: Custom Theme Picker -->
      <div class="toggle-label">
        <label for="themeColor">Theme Color:</label>
        <input type="color" id="themeColor" />
      </div>
    </div>
    
    <!-- SEARCH RESULTS PAGE -->
    <div id="searchResultsContent" class="page"></div>
    
    <!-- ========== MODALS ========== -->
    <!-- History Modal -->
    <div id="historyModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeHistoryModal">&times;</span>
        <h2>History</h2>
        <div id="historyModalContent"></div>
      </div>
    </div>
    <!-- Report Comment Modal -->
    <div id="reportModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeReportModal">&times;</span>
        <h2>Report Comment</h2>
        <input type="text" id="reportReason" placeholder="Enter reason" required />
        <button class="btn" id="submitReportButton">
          <span class="material-symbols-outlined">report</span> Report Comment
        </button>
      </div>
    </div>
    <!-- Edit Comment Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeEditModal">&times;</span>
        <h2>Edit Comment</h2>
        <input type="text" id="editCommentInput" placeholder="Edit your comment" required />
        <button class="btn" id="submitEditButton">
          <span class="material-symbols-outlined">edit</span> Save Changes
        </button>
      </div>
    </div>
    <!-- New Photo Modal -->
    <div id="newPhotoModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeNewPhotoModal">&times;</span>
        <h2>Add New Photo</h2>
        <label class="attach-label">
          Attach File
          <input type="file" id="photoFileInput" accept="image/*" style="display:none;" />
        </label>
        <img id="photoPreview" style="max-width:100%; margin-bottom:10px; display:none;" alt="Photo Preview" />
        <input type="text" id="photoTitleInput" placeholder="Photo Title" />
        <select id="photoVisibilitySelect">
          <option value="public">Public</option>
          <option value="private">Private</option>
        </select>
        <button class="btn" id="submitNewPhotoBtn">
          <span class="material-symbols-outlined">add</span> Post Photo
        </button>
      </div>
    </div>
    <!-- Edit Photo Modal -->
    <div id="editPhotoModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeEditPhotoModal">&times;</span>
        <h2>Edit Photo</h2>
        <label class="attach-label">
          Attach File
          <input type="file" id="editPhotoFileInput" accept="image/*" style="display:none;" />
        </label>
        <input type="text" id="editPhotoTitleInput" placeholder="Photo Title" />
        <select id="editPhotoVisibilitySelect">
          <option value="public">Public</option>
          <option value="private">Private</option>
        </select>
        <button class="btn" id="submitEditPhotoBtn">
          <span class="material-symbols-outlined">edit</span> Save
        </button>
      </div>
    </div>
    <!-- Report Photo Modal -->
    <div id="reportPhotoModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeReportPhotoModal">&times;</span>
        <h2>Report Photo</h2>
        <input type="text" id="reportPhotoReason" placeholder="Enter reason" required />
        <button class="btn" id="submitReportPhotoBtn">
          <span class="material-symbols-outlined">report</span> Report Photo
        </button>
      </div>
    </div>
    <!-- Create Channel Modal -->
    <div id="createChannelModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeCreateChannelModal">&times;</span>
        <h2>Create Channel</h2>
        <input type="text" id="channelNameInput" placeholder="Channel Name" required />
        <button class="btn" id="submitCreateChannelBtn">
          <span class="material-symbols-outlined">add</span> Create Channel
        </button>
      </div>
    </div>
    <!-- Upload Video Modal -->
    <div id="uploadVideoModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeUploadVideoModal">&times;</span>
        <h2>Upload Video</h2>
        <label class="attach-label">
          Attach File
          <input type="file" id="videoFileInput" accept="video/*" style="display:none;" />
        </label>
        <input type="text" id="videoTitleInput" placeholder="Video Title" />
        <input type="text" id="videoTagsInput" placeholder="Tags (optional)" />
        <select id="videoVisibilitySelect">
          <option value="public">Public</option>
          <option value="private">Private</option>
        </select>
        <label style="display:block; margin-top:5px;">Monetization:</label>
        <select id="videoMonetizationSelect">
          <option value="on">On</option>
          <option value="off">Off</option>
        </select>
        <button class="btn" id="submitUploadVideoBtn">
          <span class="material-symbols-outlined">add</span> Upload Video
        </button>
      </div>
    </div>
    <!-- Edit Video Modal -->
    <div id="editVideoModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeEditVideoModal">&times;</span>
        <h2>Edit Video</h2>
        <input type="file" id="editVideoFileInput" accept="video/*" />
        <input type="text" id="editVideoTitleInput" placeholder="Video Title" />
        <input type="text" id="editVideoTagsInput" placeholder="Tags (optional)" />
        <select id="editVideoVisibilitySelect">
          <option value="public">Public</option>
          <option value="private">Private</option>
          <option value="removed">Removed</option>
        </select>
        <label style="display:block; margin-top:5px;">Monetization:</label>
        <select id="editVideoMonetizationSelect">
          <option value="on">On</option>
          <option value="off">Off</option>
          <option value="ineligible">Ineligible</option>
        </select>
        <button class="btn" id="submitEditVideoBtn">
          <span class="material-symbols-outlined">edit</span> Save Changes
        </button>
      </div>
    </div>
    <!-- Report Video Modal -->
    <div id="reportVideoModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeReportVideoModal">&times;</span>
        <h2>Report Video</h2>
        <input type="text" id="reportVideoReason" placeholder="Enter reason" required />
        <button class="btn" id="submitReportVideoBtn">
          <span class="material-symbols-outlined">report</span> Report Video
        </button>
      </div>
    </div>
    <!-- Channel Appeal Modal -->
    <div id="channelAppealModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeChannelAppealModal">&times;</span>
        <h2>Appeal Channel Removal</h2>
        <p id="channelAppealMsg"></p>
        <input type="text" id="channelAppealReason" placeholder="Reason for appeal" />
        <button class="btn" id="submitChannelAppealBtn">
          <span class="material-symbols-outlined">undo</span> Appeal Channel
        </button>
      </div>
    </div>
    <!-- Channel Warning Modal -->
    <div id="channelWarningModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeChannelWarningModal">&times;</span>
        <h2>Channel Warning Details</h2>
        <div id="channelWarningContent"></div>
      </div>
    </div>
  </div>
  
  <!-- FULLSCREEN OVERLAY FOR VIDEO -->
  <div id="videoFullscreenOverlay">
    <div class="overlay-content">
      <video id="fullscreenVideo"></video>
      <div class="fs-controls" id="fullscreenControls">
        <button class="purple-button" id="fsPlayPauseBtn">Play</button>
        <input type="range" min="0" max="0" step="0.01" value="0" id="fsTimeSlider" />
        <span id="fsCurrentTimeLabel">0:00</span> / <span id="fsDurationLabel">0:00</span>
        <br><br>
        <label>Audio:
          <input type="range" min="0" max="100" value="100" id="fsAudioRange" style="vertical-align: middle; width:100px;">
        </label>
        <label>Speed:
          <select id="fsSpeedSelect">
            <option value="0.5">0.5x</option>
            <option value="1" selected>1.0x</option>
            <option value="1.5">1.5x</option>
            <option value="2">2.0x</option>
            <option value="4">4.0x</option>
            <option value="6">6.0x</option>
            <option value="8">8.0x</option>
            <option value="10">10.0x</option>
            <option value="16">16.0x</option>
          </select>
        </label>
        <label>Quality:
          <select id="fsQualitySelect">
            <option value="360p">360p</option>
            <option value="480p">480p</option>
            <option value="720p" selected>720p</option>
            <option value="1080p">1080p</option>
          </select>
        </label>
      </div>
      <span id="fullscreenCloseBtn">X</span>
    </div>
  </div>
  
  <script>
    /* ========== 1) Mobile/Desktop scaling ========== */
    function setViewportScale(isMobile) {
      const meta = document.querySelector('meta[name="viewport"]');
      meta.setAttribute('content', isMobile ? 'width=device-width, initial-scale=1.0' : 'width=device-width, initial-scale=0.67');
    }
    if (localStorage.getItem("forceDesktopSite") === "true") {
      setViewportScale(false);
    } else {
      setViewportScale(true);
    }
    function handleMobileSiteToggle(checked) {
      if (checked) {
        localStorage.removeItem("forceDesktopSite");
        setViewportScale(true);
      } else {
        localStorage.setItem("forceDesktopSite", "true");
        setViewportScale(false);
      }
    }
    
    /* ========== 2) Bubbles ========== */
    let bubbleInterval = null;
    let bubblesEnabled = false;
    function spawnBubbles() {
      for (let i = 0; i < 100; i++){
        let bubble = document.createElement("div");
        bubble.className = "bubble";
        let size = Math.random() * 40 + 20;
        bubble.style.width = size + "px";
        bubble.style.height = size + "px";
        bubble.style.left = Math.random() * 100 + "vw";
        let duration = Math.random() * 3 + 3;
        bubble.style.animationDuration = duration + "s";
        document.body.appendChild(bubble);
        bubble.addEventListener("animationend", () => bubble.remove());
      }
    }
    function setBubblesOnOff(on) {
      if (on === bubblesEnabled) return;
      if (on) {
        spawnBubbles();
        bubbleInterval = setInterval(spawnBubbles, 800);
      } else {
        clearInterval(bubbleInterval);
        bubbleInterval = null;
        document.querySelectorAll(".bubble").forEach(b => b.remove());
      }
      bubblesEnabled = on;
      settings.bubblesOn = on;
    }
    
    /* ========== 3) Data Arrays & Settings ========== */
    let checkHistory = [];
    let privateComments = [];
    let publicComments = [];
    let lvdLikes = 0, lvdDislikes = 0;
    let privateCommentIdCounter = 1;
    let publicCommentIdCounter = 1;
    let currentPrivateCommentId = null;
    let chatAIConversation = [];
    
    // Photos
    let photos = [];
    let photoIdCounter = 1;
    let currentPhotoId = null;
    
    // Videos + Channels
    let videos = [];
    let videoIdCounter = 1;
    let currentVideoId = null;
    let channels = [];
    let channelIdCounter = 1;
    let currentChannelId = null;
    
    // Keep track of which "view mode" for videos. "grid" by default
    let videoViewMode = "grid";

    // Keep track of active filter (string). Defaults to "all"
    let videoFilter = "all";
    
    // Settings
    let settings = { darkMode: true, showDislike: false, hideDecimals: false, bubblesOn: false };
    if (localStorage.getItem("settings")) {
      settings = JSON.parse(localStorage.getItem("settings"));
    }
    
    // Notifications
    let notifications = [];
    
    function formatPercent(val) {
      return settings.hideDecimals ? Math.round(val) + "%" : val.toFixed(1) + "%";
    }
    
    /* NOTIFICATIONS */
    function addNotification(type, message) {
      notifications.push({ type, message, timestamp: new Date() });
      updateNotificationsUI();
    }
    function updateNotificationsUI() {
      const badge = document.getElementById("notificationsBadge");
      const count = notifications.length;
      if (count > 0) {
        badge.innerText = count > 9 ? "9+" : String(count);
        badge.style.display = "inline-block";
      } else {
        badge.style.display = "none";
      }
      const dropdown = document.getElementById("notificationsDropdown");
      if (!count) {
        dropdown.innerHTML = "<p>No notifications</p>";
      } else {
        dropdown.innerHTML = "";
        notifications.slice().reverse().forEach(n => {
          dropdown.innerHTML += `<p><strong>${n.type}</strong>: ${n.message}</p>`;
        });
      }
    }
    const notificationsIcon = document.getElementById("notificationsIcon");
    const notificationsDropdown = document.getElementById("notificationsDropdown");
    notificationsIcon.addEventListener("click", e => {
      e.stopPropagation();
      let isOpen = (notificationsDropdown.style.display === "block");
      notificationsDropdown.style.display = isOpen ? "none" : "block";
      // Hide badge when opening to "mark as read"
      if (!isOpen) {
        document.getElementById("notificationsBadge").style.display = "none";
      }
    });
    document.addEventListener("click", e => {
      if (!notificationsIcon.contains(e.target) && !notificationsDropdown.contains(e.target)) {
        notificationsDropdown.style.display = "none";
      }
    });
    
    /* ========== 4) applySettings + saveSettings ========== */
    function applySettings() {
      if (settings.darkMode) {
        document.body.classList.add("dark-mode");
      } else {
        document.body.classList.remove("dark-mode");
      }
      document.querySelectorAll(".modal").forEach(m => {
        settings.darkMode ? m.classList.add("dark-mode") : m.classList.remove("dark-mode");
      });
      setBubblesOnOff(settings.bubblesOn);
      updateLVD();
      updatePrivateCommentsList();
      updatePublicCommentsList();
      updateCheckHistory();
      updateHomeDataBoxes();
      renderPhotos();
      renderVideos();
      updateNotificationsUI();
    }
    function saveSettings() {
      localStorage.setItem("settings", JSON.stringify(settings));
      applySettings();
    }
    
    /* ========== 5) Show/hide pages, overlaySidebar ========== */
    window.showPage = function(pageId) {
      const pages = [
        "homeContent","checkContent","privateCommentsContent","publicCommentsContent",
        "chatAIContent","likesVsDislikesContent","settingsContent","searchResultsContent",
        "photosContent","videosContent"
      ];
      pages.forEach(id => {
        document.getElementById(id).style.display = "none";
      });
      document.getElementById(pageId).style.display = "block";
      closeOverlaySidebar();
    };
    window.showPageByName = function(target) {
      switch(target) {
        case "home": showPage("homeContent"); break;
        case "check": showPage("checkContent"); break;
        case "comments": showPage("privateCommentsContent"); break;
        case "publiccomments": showPage("publicCommentsContent"); break;
        case "chatAI": showPage("chatAIContent"); break;
        case "photos": showPage("photosContent"); break;
        case "videos": showPage("videosContent"); break;
        case "likesvsdislikes": showPage("likesVsDislikesContent"); break;
        case "settings": showPage("settingsContent"); break;
      }
    };
    function closeOverlaySidebar() {
      document.getElementById("sidebar").classList.remove("open-overlay");
      document.getElementById("darkenOverlay").classList.remove("active");
    }
    document.querySelectorAll(".sidebar li").forEach(item => {
      item.addEventListener("click", () => {
        showPageByName(item.getAttribute("data-url"));
      });
    });
    document.querySelectorAll(".mobile-footer div").forEach(navItem => {
      navItem.addEventListener("click", () => {
        showPageByName(navItem.getAttribute("data-url"));
      });
    });
    document.getElementById("sidebarToggle").addEventListener("click", () => {
      let sidebar = document.getElementById("sidebar");
      let overlayDim = document.getElementById("darkenOverlay");
      if (window.innerWidth < 1200) {
        let isOpen = sidebar.classList.toggle("open-overlay");
        if (isOpen && window.innerWidth <= 900) overlayDim.classList.add("active");
        else overlayDim.classList.remove("active");
      } else {
        sidebar.classList.toggle("collapsed");
      }
    });
    document.getElementById("sidebarOverlayClose").addEventListener("click", () => {
      closeOverlaySidebar();
    });
    
    /* ========== 6) Searching ========== */
    function doSearch(query) {
      if (!query) return;
      let html = `<h1>Search: "${query}"</h1>`;
      let historyMatches = checkHistory.filter(e => {
        let total = e.likes + e.dislikes;
        let lp = total > 0 ? (e.likes/total)*100 : 0;
        return e.likes.toString().includes(query) ||
               e.dislikes.toString().includes(query) ||
               formatPercent(lp).includes(query);
      });
      html += "<h3>History</h3>";
      if (!historyMatches.length) {
        html += `<p>No history entries match "${query}"</p>`;
      } else {
        historyMatches.forEach((e,i) => {
          let total = e.likes+e.dislikes, lp = total>0?(e.likes/total)*100:0;
          html += `<p>Entry ${i+1}: ${formatPercent(lp)} positive (${e.likes} likes, ${e.dislikes} dislikes)</p>`;
        });
      }
      let pubMatches = publicComments.filter(c => c.name.toLowerCase().includes(query.toLowerCase()) ||
                                                  c.text.toLowerCase().includes(query.toLowerCase()));
      html += "<h3>Public Comments</h3>";
      if (!pubMatches.length) {
        html += `<p>No public comments match "${query}"</p>`;
      } else {
        pubMatches.forEach(c => {
          html += `<p><strong>${c.name}</strong>: ${c.text}</p>`;
        });
      }
      let privMatches = privateComments.filter(pc => pc.text.toLowerCase().includes(query.toLowerCase()));
      html += "<h3>Private Comments</h3>";
      if (!privMatches.length) {
        html += `<p>No private comments match "${query}"</p>`;
      } else {
        privMatches.forEach(pc => {
          html += `<p>Private #${pc.id}: ${pc.text}</p>`;
        });
      }
      let photoMatches = photos.filter(p => p.title.toLowerCase().includes(query.toLowerCase()));
      html += "<h3>Photos</h3>";
      if (!photoMatches.length) {
        html += `<p>No photos match "${query}"</p>`;
      } else {
        photoMatches.forEach(ph => {
          html += `<p>Photo #${ph.id} - ${ph.title} [${ph.visibility}]</p>`;
        });
      }
      let vidMatches = videos.filter(v =>
        v.title.toLowerCase().includes(query.toLowerCase()) ||
        (v.tags && v.tags.toLowerCase().includes(query.toLowerCase()))
      );
      html += "<h3>Videos</h3>";
      if (!vidMatches.length) {
        html += `<p>No videos match "${query}"</p>`;
      } else {
        vidMatches.forEach(vid => {
          html += `<p>Video #${vid.id} - ${vid.title} [Channel: ${vid.channel}]</p>`;
        });
      }
      document.getElementById("searchResultsContent").innerHTML = html;
      showPage("searchResultsContent");
      closeSearchOverlay();
    }
    function closeSearchOverlay() {
      document.getElementById("searchOverlay").style.display = "none";
    }
    const searchInputDesktop = document.getElementById("searchInput");
    searchInputDesktop.addEventListener("keypress", e => {
      if (e.key === "Enter") doSearch(e.target.value.trim());
    });
    const searchOverlayInput = document.getElementById("searchOverlayInput");
    searchOverlayInput.addEventListener("keypress", e => {
      if (e.key === "Enter") doSearch(e.target.value.trim());
    });
    document.getElementById("searchOverlayIcon").addEventListener("click", () => {
      doSearch(searchOverlayInput.value.trim());
    });
    document.getElementById("closeSearchOverlay").addEventListener("click", () => {
      closeSearchOverlay();
    });
    document.getElementById("searchIcon").addEventListener("click", () => {
      if (document.getElementById("topbarSearchContainer").offsetWidth <= 50) {
        document.getElementById("searchOverlay").style.display = "flex";
      } else {
        searchInputDesktop.focus();
      }
    });
    document.getElementById("searchIconMobile").addEventListener("click", () => {
      document.getElementById("searchOverlay").style.display = "flex";
    });
    
    /* ========== 7) Check% Page ========== */
    function updateCheckHistory() {
      let out = document.getElementById("checkHistory");
      out.innerHTML = "";
      checkHistory.forEach((entry, i) => {
        let total = entry.likes + entry.dislikes;
        let lp = total > 0 ? (entry.likes/total)*100 : 0;
        let dp = total > 0 ? (entry.dislikes/total)*100 : 0;
        
        // Use a 2-color bar if showDislike is ON
        let progressBarHTML = "";
        if (settings.showDislike) {
          progressBarHTML = `
            <div style="background:#ddd; width:100%; height:10px; overflow:hidden;">
              <div style="background:#4caf50; width:${lp}%; height:100%; float:left;"></div>
              <div style="background:#f44336; width:${dp}%; height:100%; float:left;"></div>
            </div>
          `;
        } else {
          progressBarHTML = `
            <div style="background:#ddd; width:100%; height:10px;">
              <div style="background:#4caf50; width:${lp}%; height:100%;"></div>
            </div>
          `;
        }

        out.innerHTML += `
          <div style="margin:10px 0;">
            <p>Entry ${i+1}: ${formatPercent(lp)} positive (${entry.likes} likes, ${entry.dislikes} dislikes)</p>
            ${progressBarHTML}
          </div>
        `;
      });
      updateHomeDataBoxes();
    }
    document.getElementById("checkForm").addEventListener("submit", e => {
      e.preventDefault();
      let likes = parseInt(document.getElementById("checkLikes").value);
      let dislikes = parseInt(document.getElementById("checkDislikes").value);
      checkHistory.push({ likes, dislikes });
      addNotification("Check %", `Added new check history: ${likes} likes / ${dislikes} dislikes`);
      updateCheckHistory();
    });
    
    /* ========== 8) Private Comments ========== */
    function updatePrivateCommentsList() {
      let out = document.getElementById("privateCommentsList");
      out.innerHTML = "";
      privateComments.forEach(c => {
        let total = c.likes + c.dislikes;
        let lp = total > 0 ? (c.likes/total)*100 : 0;
        let dp = total > 0 ? (c.dislikes/total)*100 : 0;
        
        let progressBarHTML = "";
        if (settings.showDislike) {
          progressBarHTML = `
            <div style="background:#ddd; width:100%; height:10px; overflow:hidden;">
              <div style="background:#4caf50; width:${lp}%; height:100%; float:left;"></div>
              <div style="background:#f44336; width:${dp}%; height:100%; float:left;"></div>
            </div>
          `;
        } else {
          progressBarHTML = `
            <div style="background:#ddd; width:100%; height:10px;">
              <div style="background:#4caf50; width:${lp}%; height:100%;"></div>
            </div>
          `;
        }

        out.innerHTML += `
          <div style="border:1px solid #ccc; margin:10px 0; padding:10px;">
            <p class="truncate" title="${c.text}">${c.text}</p>
            <p>Likes: ${c.likes}, Dislikes: ${c.dislikes} (${formatPercent(lp)} positive)</p>
            ${progressBarHTML}
            <button class="btn" onclick="updatePrivateComment(${c.id}, 'like')">
              <span class="material-symbols-outlined">thumb_up</span> Like
            </button>
            <button class="btn" onclick="updatePrivateComment(${c.id}, 'dislike')">
              <span class="material-symbols-outlined">thumb_down</span> Dislike
            </button>
            <button class="btn" onclick="updatePrivateComment(${c.id}, 'minusLike')">
              <span class="material-symbols-outlined">exposure_minus_1</span> -1 Like
            </button>
            <button class="btn" onclick="updatePrivateComment(${c.id}, 'minusDislike')">
              <span class="material-symbols-outlined">exposure_minus_1</span> -1 Dislike
            </button>
            <button class="btn" onclick="openEditModal(${c.id})">
              <span class="material-symbols-outlined">edit</span> Edit
            </button>
            <button class="btn" onclick="openReportModal(${c.id})">
              <span class="material-symbols-outlined">report</span> Report
            </button>
          </div>
        `;
      });
      updateHomeDataBoxes();
    }
    document.getElementById("privateCommentForm").addEventListener("submit", e => {
      e.preventDefault();
      let text = document.getElementById("privateCommentInput").value.trim();
      if (text) {
        privateComments.push({ id: privateCommentIdCounter++, text, likes: 0, dislikes: 0 });
        addNotification("Private Comment", `New private comment added: "${text}"`);
      }
      document.getElementById("privateCommentInput").value = "";
      updatePrivateCommentsList();
    });
    window.updatePrivateComment = function(id, action) {
      let c = privateComments.find(x => x.id === id);
      if (!c) return;
      if (action==="like") {
        c.likes++;
        addNotification("Like", `You liked Private Comment #${id}`);
      } else if (action==="dislike") {
        c.dislikes++;
        addNotification("Dislike", `You disliked Private Comment #${id}`);
      } else if (action==="minusLike" && c.likes>0) {
        c.likes--;
      } else if (action==="minusDislike" && c.dislikes>0) {
        c.dislikes--;
      }
      updatePrivateCommentsList();
    };
    window.openReportModal = function(cid) {
      currentPrivateCommentId = cid;
      document.getElementById("reportReason").value = "";
      document.getElementById("reportModal").style.display = "block";
    };
    document.getElementById("submitReportButton").addEventListener("click", () => {
      let reason = document.getElementById("reportReason").value.trim();
      if (!reason) {
        alert("Please enter a report reason!");
        return;
      }
      privateComments = privateComments.filter(c => c.id !== currentPrivateCommentId);
      addNotification("Report", `You reported Private Comment #${currentPrivateCommentId} (removed). Reason: ${reason}`);
      currentPrivateCommentId = null;
      document.getElementById("reportModal").style.display = "none";
      updatePrivateCommentsList();
    });
    document.getElementById("closeReportModal").addEventListener("click", () => {
      document.getElementById("reportModal").style.display = "none";
      currentPrivateCommentId = null;
    });
    window.openEditModal = function(cid) {
      currentPrivateCommentId = cid;
      let c = privateComments.find(x => x.id === cid);
      if (c) {
        document.getElementById("editCommentInput").value = c.text;
        document.getElementById("editModal").style.display = "block";
      }
    };
    document.getElementById("submitEditButton").addEventListener("click", () => {
      let newText = document.getElementById("editCommentInput").value.trim();
      if (!newText) {
        alert("Comment can't be empty!");
        return;
      }
      let c = privateComments.find(x => x.id === currentPrivateCommentId);
      if (c) {
        c.text = newText;
        addNotification("Edit", `Edited Private Comment #${c.id}`);
      }
      document.getElementById("editModal").style.display = "none";
      currentPrivateCommentId = null;
      updatePrivateCommentsList();
    });
    document.getElementById("closeEditModal").addEventListener("click", () => {
      document.getElementById("editModal").style.display = "none";
      currentPrivateCommentId = null;
    });
    
    /* ========== 9) Public Comments ========== */
    const allowedWords = [..."a able accept awesome be beautiful best blessed bloom bright brilliant calm care cheer cheerful clean cool creative cute delight delightful enjoy enjoying enjoyment excellent fair fine friendly fun funny genius gift giggle glad good grace graceful grateful great haha happy hello helpful hey hi hug idea joy kind kindness laugh like love lovely lucky magic magnificent marvelous maybe nice okay optimistic peace perfect play please positive praise pretty proud relax respect safe share shine sincere smart smile so soft spark sparkle strong super support surprise sweet thank thanks thankful this together useful very warm welcome wow yes you daddy mom mommy cat dog crazy".split(" ")];
    const allowedDomains = ["youtube.com", "facebook.com", "tiktok.com", "instagram.com"];
    if (localStorage.getItem("publicComments")){
      publicComments = JSON.parse(localStorage.getItem("publicComments"));
      publicCommentIdCounter = publicComments.length ? Math.max(...publicComments.map(c => c.id)) + 1 : 1;
    }
    function saveData() {
      localStorage.setItem("publicComments", JSON.stringify(publicComments));
    }
    function checkLinksAllowed(str) {
      let pattern = /\bhttps?:\/\/[^\s]+|www\.[^\s]+|\b\w+\.\w{2,3}\b/gi;
      let found = str.match(pattern);
      if (!found) return true;
      for (let link of found) {
        let domainFound = false;
        for (let d of allowedDomains) {
          if (link.includes(d)) {
            domainFound = true;
            break;
          }
        }
        if (!domainFound) return false;
      }
      return true;
    }
    function isNumeric(token) {
      return /^\d+$/.test(token);
    }
    function checkAllowedWords(str) {
      let tokens = str.toLowerCase().split(/\W+/).filter(Boolean);
      for (let t of tokens) {
        if (t.includes(".") || t.includes("/")) continue;
        if (isNumeric(t)) continue;
        if (!allowedWords.includes(t)) return t;
      }
      return null;
    }
    document.getElementById("publicCommentForm").addEventListener("submit", e => {
      e.preventDefault();
      let name = document.getElementById("publicCommentName").value.trim();
      let text = document.getElementById("publicCommentInput").value.trim();
      if (!name || !text) return;
      let combined = name + " " + text;
      let badWord = checkAllowedWords(combined);
      if (badWord) {
        alert(`The word "${badWord}" is not allowed. Only certain words or numbers are permitted.`);
        return;
      }
      if (!checkLinksAllowed(combined.toLowerCase())) {
        alert("Your comment has an unallowed link. Only youtube.com, facebook.com, tiktok.com, or instagram.com are permitted!");
        return;
      }
      let c = { id: publicCommentIdCounter++, name, text, likes: 0, dislikes: 0 };
      publicComments.push(c);
      addNotification("Public Comment", `New public comment from ${name}: "${text}"`);
      saveData();
      document.getElementById("publicCommentName").value = "";
      document.getElementById("publicCommentInput").value = "";
      updatePublicCommentsList();
    });
    function updatePublicCommentsList() {
      let out = document.getElementById("publicCommentsList");
      out.innerHTML = "";
      publicComments.forEach(c => {
        let total = c.likes + c.dislikes;
        let lp = total > 0 ? (c.likes/total)*100 : 0;
        let dp = total > 0 ? (c.dislikes/total)*100 : 0;

        let progressBarHTML = "";
        if (settings.showDislike) {
          progressBarHTML = `
            <div style="background:#ddd; width:100%; height:10px; overflow:hidden;">
              <div style="background:#4caf50; width:${lp}%; height:100%; float:left;"></div>
              <div style="background:#f44336; width:${dp}%; height:100%; float:left;"></div>
            </div>
          `;
        } else {
          progressBarHTML = `
            <div style="background:#ddd; width:100%; height:10px;">
              <div style="background:#4caf50; width:${lp}%; height:100%;"></div>
            </div>
          `;
        }

        out.innerHTML += `
          <div style="border:1px solid #ccc; margin:10px 0; padding:10px;">
            <p><strong>${c.name}</strong>: ${c.text}</p>
            <p>Likes: ${c.likes}, Dislikes: ${c.dislikes} (${formatPercent(lp)} positive)</p>
            ${progressBarHTML}
            <button class="btn" onclick="updatePublicComment(${c.id}, 'like')">
              <span class="material-symbols-outlined">thumb_up</span> Like
            </button>
            <button class="btn" onclick="updatePublicComment(${c.id}, 'dislike')">
              <span class="material-symbols-outlined">thumb_down</span> Dislike
            </button>
          </div>
        `;
      });
    }
    window.updatePublicComment = function(id, action) {
      let c = publicComments.find(x => x.id === id);
      if (!c) return;
      if (action==="like") {
        c.likes++;
        addNotification("Like", `You liked Public Comment #${id}`);
      } else if (action==="dislike") {
        c.dislikes++;
        addNotification("Dislike", `You disliked Public Comment #${id}`);
      }
      saveData();
      updatePublicCommentsList();
    };
    
    /* ========== 10) Likes vs Dislikes ========== */
    function updateLVD() {
      let total = lvdLikes + lvdDislikes;
      let lp = total > 0 ? (lvdLikes/total)*100 : 0;
      let dp = total > 0 ? (lvdDislikes/total)*100 : 0;
      let html = "";
      if (settings.showDislike) {
        html = `
          <p>Likes: ${lvdLikes} Dislikes: ${lvdDislikes} (Like: ${formatPercent(lp)}, Dislike: ${formatPercent(dp)})</p>
          <div style="display:flex; gap:5px;">
            <div style="background:#ddd; width:50%; height:20px;">
              <div style="background:#4caf50; width:${lp}%; height:100%;"></div>
            </div>
            <div style="background:#ddd; width:50%; height:20px;">
              <div style="background:#f44336; width:${dp}%; height:100%;"></div>
            </div>
          </div>
        `;
      } else {
        html = `
          <p>Likes: ${lvdLikes} Dislikes: ${lvdDislikes} (${formatPercent(lp)} positive)</p>
          <div style="background:#ddd; width:100%; height:20px;">
            <div style="background:#4caf50; width:${lp}%; height:100%;"></div>
          </div>
        `;
      }
      document.getElementById("lvdResult").innerHTML = html;
    }
    document.querySelectorAll(".lvd-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        let t = btn.getAttribute("data-type");
        let m = parseInt(btn.getAttribute("data-multiplier"));
        if (t==="like") {
          lvdLikes += m;
          addNotification("Like", `You added ${m} likes to LVD`);
        } else {
          lvdDislikes += m;
          addNotification("Dislike", `You added ${m} dislikes to LVD`);
        }
        updateLVD();
      });
    });
    document.getElementById("lvdForm").addEventListener("submit", e => {
      e.preventDefault();
      let t = document.getElementById("lvdType").value;
      let amt = parseInt(document.getElementById("lvdInput").value);
      if (t==="like") {
        lvdLikes += amt;
        addNotification("Like", `You added ${amt} likes to LVD`);
      } else {
        lvdDislikes += amt;
        addNotification("Dislike", `You added ${amt} dislikes to LVD`);
      }
      updateLVD();
    });
    
    /* ========== 11) Chat AI ========== */
    const chatAIReplies = [
      "Certainly! I can help with that.",
      "Yes, that makes sense.",
      "No problem at all!",
      "Could you clarify that?",
      "Let's do this!",
      "I see your point.",
      "Time to wrap it up!"
    ];
    document.getElementById("chatAISend").addEventListener("click", () => {
      let msg = document.getElementById("chatAIInput").value.trim();
      if (!msg) return;
      document.getElementById("chatAIInput").value = "";
      appendChatMessage("You", msg, false);
      let r = Math.floor(Math.random() * chatAIReplies.length);
      let bot = chatAIReplies[r];
      setTimeout(() => {
        appendChatMessage("Bot", bot, true);
      }, 400);
    });
    function appendChatMessage(sender, text, isBot) {
      let c = document.getElementById("chatAIMessages");
      let d = document.createElement("div");
      d.style.padding = "8px";
      d.style.marginBottom = "6px";
      d.style.background = "#f5f5f5";
      d.style.borderRadius = "4px";
      d.innerHTML = `<strong>${sender}:</strong> <span class="truncate" title="${text}">${text}</span>`;
      c.appendChild(d);
      c.scrollTop = c.scrollHeight;
      chatAIConversation.push({ sender, text });
      if (isBot) {
        let addBtn = document.createElement("button");
        addBtn.classList.add("btn");
        addBtn.style.marginTop = "4px";
        addBtn.innerText = "Add to comment";
        addBtn.addEventListener("click", () => {
          let combined = text.toLowerCase();
          let tokens = combined.split(/\W+/).filter(Boolean);
          for (let t of tokens) {
            if (t.includes(".") || t.includes("/")) continue;
            if (!/^\d+$/.test(t) && !allowedWords.includes(t)) {
              alert(`AI text contains the word "${t}" which is not allowed here.`);
              return;
            }
          }
          if (!checkLinksAllowed(combined)) {
            alert("AI text has an unallowed link. Only certain domains are permitted!");
            return;
          }
          let cobj = { id: publicCommentIdCounter++, name:"AI Bot", text, likes: 0, dislikes: 0 };
          publicComments.push(cobj);
          addNotification("Public Comment", "AI reply added to public comments.");
          saveData();
          updatePublicCommentsList();
          alert("AI reply added to public comments!");
        });
        d.appendChild(addBtn);
      }
      updateHomeDataBoxes();
    }
    
    /* ========== 12) Update Home Page Data Boxes ========== */
    function updateHomeDataBoxes() {
      // Private Comments
      let homePriv = document.getElementById("homePrivateComments");
      if (privateComments.length === 0) {
        homePriv.innerHTML = "<p>No Content Available.</p>";
      } else {
        homePriv.innerHTML = "";
        privateComments.forEach(pc => {
          let total = pc.likes + pc.dislikes;
          let lp = total>0?(pc.likes/total)*100:0;
          let dp = total>0?(pc.dislikes/total)*100:0;

          let progressBarHTML = "";
          if (settings.showDislike) {
            progressBarHTML = `
              <div style="background:#ddd; width:100%; height:10px; overflow:hidden;">
                <div style="background:#4caf50; width:${lp}%; height:100%; float:left;"></div>
                <div style="background:#f44336; width:${dp}%; height:100%; float:left;"></div>
              </div>
            `;
          } else {
            progressBarHTML = `
              <div style="background:#ddd; width:100%; height:10px;">
                <div style="background:#4caf50; width:${lp}%; height:100%;"></div>
              </div>
            `;
          }

          homePriv.innerHTML += `
            <div style="border:1px solid #ccc; margin-bottom:5px; padding:5px;">
              <p class="truncate" title="${pc.text}">${pc.text}</p>
              <p>Likes: ${pc.likes}, Dislikes: ${pc.dislikes} (${formatPercent(lp)} positive)</p>
              ${progressBarHTML}
              <button class="btn" onclick="updatePrivateComment(${pc.id}, 'like')">
                <span class="material-symbols-outlined">thumb_up</span> Like
              </button>
              <button class="btn" onclick="updatePrivateComment(${pc.id}, 'dislike')">
                <span class="material-symbols-outlined">thumb_down</span> Dislike
              </button>
              <button class="btn" onclick="updatePrivateComment(${pc.id}, 'minusLike')">
                <span class="material-symbols-outlined">exposure_minus_1</span> -1
              </button>
              <button class="btn" onclick="updatePrivateComment(${pc.id}, 'minusDislike')">
                <span class="material-symbols-outlined">exposure_minus_1</span> -1
              </button>
              <button class="btn" onclick="openEditModal(${pc.id})">
                <span class="material-symbols-outlined">edit</span> Edit
              </button>
              <button class="btn" onclick="openReportModal(${pc.id})">
                <span class="material-symbols-outlined">report</span> Report
              </button>
            </div>
          `;
        });
      }
      // History
      let homeHist = document.getElementById("homeHistory");
      if (checkHistory.length === 0) {
        homeHist.innerHTML = "<p>No Content Available.</p>";
      } else {
        homeHist.innerHTML = "";
        checkHistory.forEach((entry, i) => {
          let total = entry.likes + entry.dislikes;
          let lp = total>0?(entry.likes/total)*100:0;
          let dp = total>0?(entry.dislikes/total)*100:0;

          let progressBarHTML = "";
          if (settings.showDislike) {
            progressBarHTML = `
              <div style="background:#ddd; width:100%; height:10px; overflow:hidden;">
                <div style="background:#4caf50; width:${lp}%; height:100%; float:left;"></div>
                <div style="background:#f44336; width:${dp}%; height:100%; float:left;"></div>
              </div>
            `;
          } else {
            progressBarHTML = `
              <div style="background:#ddd; width:100%; height:10px;">
                <div style="background:#4caf50; width:${lp}%; height:100%;"></div>
              </div>
            `;
          }

          homeHist.innerHTML += `
            <div style="margin-bottom:5px;">
              <p>Entry ${i+1}: ${formatPercent(lp)} positive (${entry.likes} likes, ${entry.dislikes} dislikes)</p>
              ${progressBarHTML}
            </div>
          `;
        });
      }
      // Chat AI
      let homeChat = document.getElementById("homeChatAIHistory");
      if (chatAIConversation.length === 0) {
        homeChat.innerHTML = "<p>No Content Available.</p>";
      } else {
        homeChat.innerHTML = chatAIConversation.map(m => `<p><strong>${m.sender}:</strong> <span class="truncate" title="${m.text}">${m.text}</span></p>`).join("");
      }
      // Photos
      let homePhotos = document.getElementById("homePhotosList");
      if (photos.length === 0) {
        homePhotos.innerHTML = "<p>No Content Available.</p>";
      } else {
        homePhotos.innerHTML = "";
        photos.forEach(p => {
          let total = p.likes + p.dislikes;
          let lp = total>0?(p.likes/total)*100:0;
          let dp = total>0?(p.dislikes/total)*100:0;

          let progressBarHTML = "";
          if (settings.showDislike) {
            progressBarHTML = `
              <div style="background:#ddd; width:100%; height:10px; overflow:hidden;">
                <div style="background:#4caf50; width:${lp}%; height:100%; float:left;"></div>
                <div style="background:#f44336; width:${dp}%; height:100%; float:left;"></div>
              </div>
            `;
          } else {
            progressBarHTML = `
              <div style="background:#ddd; width:100%; height:10px;">
                <div style="background:#4caf50; width:${lp}%; height:100%;"></div>
              </div>
            `;
          }

          if (p.visibility==="removed") {
            homePhotos.innerHTML += `
              <div style="border:1px solid #ccc; margin-bottom:5px; padding:5px;">
                <h3 class="truncate" title="${p.title}">${p.title} (Removed)</h3>
                <p><span class="material-symbols-outlined">block</span> Visibility: Removed</p>
                <img src="${p.fileURL}" alt="${p.title}" style="max-width:200px; display:block; filter: blur(8px);" />
                <p style="color:red;">This photo has been reported and removed</p>
                <p>Likes: ${p.likes}, Dislikes: ${p.dislikes} (${formatPercent(lp)} positive)</p>
                ${progressBarHTML}
              </div>
            `;
          } else {
            let icon = (p.visibility==="public") ? "public" : "lock";
            homePhotos.innerHTML += `
              <div style="border:1px solid #ccc; margin-bottom:5px; padding:10px;">
                <h3 class="truncate" title="${p.title}">${p.title}</h3>
                <p><span class="material-symbols-outlined">${icon}</span> Visibility: ${p.visibility}</p>
                <img src="${p.fileURL}" alt="${p.title}" style="max-width:200px; display:block;" />
                <p>Likes: ${p.likes}, Dislikes: ${p.dislikes} (${formatPercent(lp)} positive)</p>
                ${progressBarHTML}
                <button class="btn" onclick="likePhoto(${p.id},1)">
                  <span class="material-symbols-outlined">thumb_up</span> Like
                </button>
                <button class="btn" onclick="likePhoto(${p.id},-1)">
                  <span class="material-symbols-outlined">thumb_down</span> Dislike
                </button>
                <button class="btn" onclick="openEditPhotoModal(${p.id})">
                  <span class="material-symbols-outlined">edit</span> Edit
                </button>
                <button class="btn" onclick="openReportPhotoModal(${p.id})">
                  <span class="material-symbols-outlined">report</span> Report
                </button>
              </div>
            `;
          }
        });
      }
      // Videos list on Home
      let homeVideos = document.getElementById("homeVideosListRight");
      if (videos.length===0) {
        homeVideos.innerHTML = "<p>No Content Available.</p>";
      } else {
        homeVideos.innerHTML = "";
        videos.forEach(v => {
          let total = v.likes + v.dislikes;
          let lp = total>0?(v.likes/total)*100:0;
          let dp = total>0?(v.dislikes/total)*100:0;

          let progressBarHTML = "";
          if (settings.showDislike) {
            progressBarHTML = `
              <div style="background:#ddd; width:100%; height:10px; overflow:hidden;">
                <div style="background:#4caf50; width:${lp}%; height:100%; float:left;"></div>
                <div style="background:#f44336; width:${dp}%; height:100%; float:left;"></div>
              </div>
            `;
          } else {
            progressBarHTML = `
              <div style="background:#ddd; width:100%; height:10px;">
                <div style="background:#4caf50; width:${lp}%; height:100%;"></div>
              </div>
            `;
          }

          if (v.visibility==="removed") {
            let ch = channels.find(ch => ch.name===v.channel);
            homeVideos.innerHTML += `
              <div style="border:1px solid #ccc; margin-bottom:5px; padding:5px;">
                <h3 class="truncate" title="${v.title}">${v.title} (Removed)</h3>
                <p>This video is removed.</p>
                <p>Active Strikes: ${ch ? ch.strikes||0 : 0} of 5</p>
              </div>
            `;
          } else {
            let visibleIcon = (v.visibility==="private") ? "lock" : "public";
            if (v.visibility==="removed") visibleIcon = "block";
            let monetIcon = "paid";
            if (v.monetization==="off") monetIcon = "money_off";
            if (v.monetization==="ineligible") monetIcon = "do_not_disturb_on";
            homeVideos.innerHTML += `
              <div style="border:1px solid #ccc; margin-bottom:5px; padding:5px;">
                <h3 class="truncate" title="${v.title}">${v.title}</h3>
                <p>Channel: ${v.channel}</p>
                <p>
                  <span class="material-symbols-outlined">${visibleIcon}</span> ${v.visibility}
                  &nbsp;|&nbsp;
                  <span class="material-symbols-outlined">${monetIcon}</span> Monetization: ${v.monetization}
                </p>
                <p>Date: ${v.date || "Unknown"}</p>
                <p>Likes: ${v.likes}, Dislikes: ${v.dislikes} (${formatPercent(lp)} positive)</p>
                ${progressBarHTML}
                <button class="btn" onclick="likeVideo(${v.id},1)">Like</button>
                <button class="btn" onclick="likeVideo(${v.id},-1)">Dislike</button>
                <button class="btn" onclick="openEditVideoModal(${v.id})">Edit</button>
                <button class="btn" onclick="openReportVideoModal(${v.id})">Report</button>
                <button class="btn" onclick="openFullscreen(${v.id})">Preview</button>
              </div>
            `;
          }
        });
      }
      // Channels
      let channelsContainer = document.getElementById("homeChannelsList");
      if (channels.length===0) {
        document.getElementById("boxChannelsList").style.display = "block";
      } else {
        channelsContainer.innerHTML = "";
        channels.forEach(ch => {
          channelsContainer.innerHTML += `<p>Channel: ${ch.name}  Active Strikes: ${ch.strikes||0} of 5
            ${ch.strikes>0?'<button class="btn" onclick="openChannelWarningModal('+ch.id+')">See More</button>':''}
          </p>`;
        });
      }
      // Channel warnings
      let warningsContainer = document.getElementById("homeChannelWarnings");
      let warnings = channels.filter(ch => (ch.strikes||0)>0);
      if (warnings.length===0) {
        warningsContainer.innerHTML = "<p>No Content Available.</p>";
      } else {
        warningsContainer.innerHTML = warnings.map(ch =>
          `<p>Channel: ${ch.name}  Active Strikes: ${ch.strikes} of 5 
           <button class="btn" onclick="openChannelWarningModal(${ch.id})">See More</button>
          </p>`
        ).join("");
      }
    }
    
    /* ========== 13) Settings ========== */
    document.getElementById("toggleDarkMode").checked = settings.darkMode;
    document.getElementById("toggleShowDislike").checked = settings.showDislike;
    document.getElementById("toggleHideDecimals").checked = settings.hideDecimals;
    document.getElementById("toggleBubbles").checked = settings.bubblesOn;
    const toggleMobileSite = document.getElementById("toggleMobileSite");
    let isDesktop = localStorage.getItem("forceDesktopSite") === "true";
    toggleMobileSite.checked = !isDesktop;
    document.getElementById("toggleDarkMode").addEventListener("change", function() {
      settings.darkMode = this.checked;
      saveSettings();
    });
    document.getElementById("toggleShowDislike").addEventListener("change", function() {
      settings.showDislike = this.checked;
      saveSettings();
    });
    document.getElementById("toggleHideDecimals").addEventListener("change", function() {
      settings.hideDecimals = this.checked;
      saveSettings();
    });
    toggleMobileSite.addEventListener("change", function() {
      handleMobileSiteToggle(this.checked);
    });
    document.getElementById("toggleBubbles").addEventListener("change", function() {
      setBubblesOnOff(this.checked);
      saveSettings();
    });
    // NEW: Custom Theme Color Picker now updates topbar, sidebar, and content backgrounds
    if(settings.themeColor) {
      document.documentElement.style.setProperty('--custom-theme-color', settings.themeColor);
      document.body.classList.add("custom-theme");
      document.getElementById("themeColor").value = settings.themeColor;
    } else {
      document.documentElement.style.setProperty('--custom-theme-color', "#2a2a2a");
      document.getElementById("themeColor").value = "#2a2a2a";
    }
    document.getElementById("themeColor").addEventListener("input", function() {
      settings.themeColor = this.value;
      localStorage.setItem("settings", JSON.stringify(settings));
      document.documentElement.style.setProperty('--custom-theme-color', this.value);
      document.body.classList.add("custom-theme");
    });
    
    /* ========== 14) History Modal ========== */
    const historyIcon = document.getElementById("historyIcon");
    const historyModal = document.getElementById("historyModal");
    const closeHistoryModal = document.getElementById("closeHistoryModal");
    const historyModalContent = document.getElementById("historyModalContent");
    historyIcon.addEventListener("click", () => {
      let html = checkHistory.length
        ? checkHistory.map((h, i) => {
            let total = h.likes+h.dislikes, lp=total>0?(h.likes/total)*100:0;
            if (settings.showDislike) {
              let dp = total>0?(h.dislikes/total)*100:0;
              return `<p>Entry ${i+1}: ${formatPercent(lp)} positive, ${formatPercent(dp)} negative (${h.likes} likes, ${h.dislikes} dislikes)</p>`;
            } else {
              return `<p>Entry ${i+1}: ${formatPercent(lp)} positive (${h.likes} likes, ${h.dislikes} dislikes)</p>`;
            }
          }).join("")
        : "<p>No Content Available.</p>";
      historyModalContent.innerHTML = html;
      historyModal.style.display = "block";
    });
    closeHistoryModal.addEventListener("click", () => {
      historyModal.style.display = "none";
    });
    
    /* ========== 15) PHOTOS MODALS & Logic ========== */
    const newPhotoModal = document.getElementById("newPhotoModal");
    const closeNewPhotoModal = document.getElementById("closeNewPhotoModal");
    const editPhotoModal = document.getElementById("editPhotoModal");
    const closeEditPhotoModal = document.getElementById("closeEditPhotoModal");
    const reportPhotoModal = document.getElementById("reportPhotoModal");
    const closeReportPhotoModal = document.getElementById("closeReportPhotoModal");
    closeNewPhotoModal.addEventListener("click", () => { newPhotoModal.style.display = "none"; });
    closeEditPhotoModal.addEventListener("click", () => { editPhotoModal.style.display = "none"; currentPhotoId = null; });
    closeReportPhotoModal.addEventListener("click", () => { reportPhotoModal.style.display = "none"; currentPhotoId = null; });
    window.openNewPhotoModal = function() {
      document.getElementById("photoFileInput").value = "";
      document.getElementById("photoTitleInput").value = "";
      document.getElementById("photoVisibilitySelect").value = "public";
      document.getElementById("photoPreview").style.display = "none";
      newPhotoModal.style.display = "block";
    };
    document.getElementById("photoFileInput").addEventListener("change", function() {
      const file = this.files[0];
      const preview = document.getElementById("photoPreview");
      if (file) {
        preview.src = URL.createObjectURL(file);
        preview.style.display = "block";
      } else {
        preview.style.display = "none";
      }
    });
    document.getElementById("submitNewPhotoBtn").addEventListener("click", () => {
      let fileInput = document.getElementById("photoFileInput");
      let title = document.getElementById("photoTitleInput").value.trim();
      let vis = document.getElementById("photoVisibilitySelect").value;
      if (!fileInput.files.length) {
        alert("Please attach a file!");
        return;
      }
      if (!title) {
        alert("Please enter a title!");
        return;
      }
      let file = fileInput.files[0];
      let fileURL = URL.createObjectURL(file);
      photos.push({ id: photoIdCounter++, title, fileURL, visibility: vis, likes: 0, dislikes: 0, removed: false, reason: null });
      addNotification("Photo Uploaded", `New photo titled "${title}" uploaded.`);
      newPhotoModal.style.display = "none";
      renderPhotos();
      updateHomeDataBoxes();
    });
    function renderPhotos(){
      let c = document.getElementById("photosList");
      c.innerHTML = "";
      photos.forEach(p => {
        let total = p.likes + p.dislikes;
        let lp = total>0?(p.likes/total)*100:0;
        let dp = total>0?(p.dislikes/total)*100:0;

        let progressBarHTML = "";
        if (settings.showDislike) {
          progressBarHTML = `
            <div style="background:#ddd; width:100%; height:10px; overflow:hidden;">
              <div style="background:#4caf50; width:${lp}%; height:100%; float:left;"></div>
              <div style="background:#f44336; width:${dp}%; height:100%; float:left;"></div>
            </div>
          `;
        } else {
          progressBarHTML = `
            <div style="background:#ddd; width:100%; height:10px;">
              <div style="background:#4caf50; width:${lp}%; height:100%;"></div>
            </div>
          `;
        }

        let html = "";
        if (p.visibility==="removed") {
          html = `
            <div style="border:1px solid #ccc; margin-bottom:5px; padding:10px;">
              <h3 class="truncate" title="${p.title}">${p.title} (Removed)</h3>
              <p><span class="material-symbols-outlined">block</span> Visibility: Removed</p>
              <img src="${p.fileURL}" alt="${p.title}" style="max-width:200px; display:block; filter: blur(8px);" />
              <p style="color:red;">This photo has been reported and removed</p>
              <p>Likes: ${p.likes}, Dislikes: ${p.dislikes} (${formatPercent(lp)} positive)</p>
              ${progressBarHTML}
            </div>
          `;
        } else {
          let icon = (p.visibility==="public")?"public":"lock";
          html = `
            <div style="border:1px solid #ccc; margin-bottom:5px; padding:10px;">
              <h3 class="truncate" title="${p.title}">${p.title}</h3>
              <p><span class="material-symbols-outlined">${icon}</span> Visibility: ${p.visibility}</p>
              <img src="${p.fileURL}" alt="${p.title}" style="max-width:200px; display:block;" />
              <p>Likes: ${p.likes}, Dislikes: ${p.dislikes} (${formatPercent(lp)} positive)</p>
              ${progressBarHTML}
              <button class="btn" onclick="likePhoto(${p.id},1)">
                <span class="material-symbols-outlined">thumb_up</span> Like
              </button>
              <button class="btn" onclick="likePhoto(${p.id},-1)">
                <span class="material-symbols-outlined">thumb_down</span> Dislike
              </button>
              <button class="btn" onclick="openEditPhotoModal(${p.id})">
                <span class="material-symbols-outlined">edit</span> Edit
              </button>
              <button class="btn" onclick="openReportPhotoModal(${p.id})">
                <span class="material-symbols-outlined">report</span> Report
              </button>
            </div>
          `;
        }
        c.innerHTML += html;
      });
    }
    window.likePhoto = function(pid, delta) {
      let p = photos.find(x => x.id === pid);
      if (!p || p.visibility==="removed") return;
      if (delta>0) {
        p.likes++;
        addNotification("Like", `You liked Photo #${pid}`);
      } else {
        p.dislikes++;
        addNotification("Dislike", `You disliked Photo #${pid}`);
      }
      renderPhotos();
      updateHomeDataBoxes();
    };
    window.openEditPhotoModal = function(pid) {
      currentPhotoId = pid;
      let p = photos.find(x => x.id===pid);
      if (!p) return;
      document.getElementById("editPhotoFileInput").value = "";
      document.getElementById("editPhotoTitleInput").value = p.title;
      document.getElementById("editPhotoVisibilitySelect").value = p.visibility;
      editPhotoModal.style.display = "block";
    };
    document.getElementById("submitEditPhotoBtn").addEventListener("click", () => {
      let p = photos.find(x => x.id===currentPhotoId);
      if (!p) return;
      let newFile = document.getElementById("editPhotoFileInput").files[0];
      let newTitle = document.getElementById("editPhotoTitleInput").value.trim();
      let newVis = document.getElementById("editPhotoVisibilitySelect").value;
      if (newTitle) p.title = newTitle;
      if (newFile) {
        let newURL = URL.createObjectURL(newFile);
        p.fileURL = newURL;
      }
      p.visibility = newVis;
      addNotification("Photo Edit", `Photo #${p.id} updated.`);
      editPhotoModal.style.display = "none";
      currentPhotoId = null;
      renderPhotos();
      updateHomeDataBoxes();
    });
    window.openReportPhotoModal = function(pid) {
      currentPhotoId = pid;
      document.getElementById("reportPhotoReason").value = "";
      reportPhotoModal.style.display = "block";
    };
    document.getElementById("submitReportPhotoBtn").addEventListener("click", () => {
      let reason = document.getElementById("reportPhotoReason").value.trim();
      if (!reason) {
        alert("Please provide a reason!");
        return;
      }
      let p = photos.find(x => x.id===currentPhotoId);
      if (p) {
        p.visibility = "removed";
        p.removed = true;
        p.reason = reason;
        addNotification("Report", `You reported Photo #${p.id}. Reason: ${reason}`);
      }
      reportPhotoModal.style.display = "none";
      currentPhotoId = null;
      renderPhotos();
      updateHomeDataBoxes();
    });
    
    /* ========== 16) VIDEOS & CHANNELS Logic ========== */
    const createChannelModal = document.getElementById("createChannelModal");
    const closeCreateChannelModal = document.getElementById("closeCreateChannelModal");
    closeCreateChannelModal.addEventListener("click", () => { createChannelModal.style.display = "none"; });
    document.getElementById("submitCreateChannelBtn").addEventListener("click", () => {
      let name = document.getElementById("channelNameInput").value.trim();
      if (!name) {
        alert("Channel name cannot be empty");
        return;
      }
      channels.push({ id: channelIdCounter++, name, removed: false, removedReason: "", videosRemovedCount: 0, strikes: 0 });
      addNotification("Channel", `New channel created: "${name}"`);
      createChannelModal.style.display = "none";
      loadChannelsDropdown();
      updateHomeDataBoxes();
    });
    window.openCreateChannelModal = function() {
      document.getElementById("channelNameInput").value = "";
      createChannelModal.style.display = "block";
    };
    
    function loadChannelsDropdown() {
      let sel = document.getElementById("channelsDropdown");
      sel.innerHTML = "";
      let validChannels = channels.filter(ch => !ch.removed);
      validChannels.forEach(ch => {
        let opt = document.createElement("option");
        opt.value = ch.id;
        opt.textContent = ch.name;
        sel.appendChild(opt);
      });
    }
    const uploadVideoModal = document.getElementById("uploadVideoModal");
    const closeUploadVideoModal = document.getElementById("closeUploadVideoModal");
    closeUploadVideoModal.addEventListener("click", () => { uploadVideoModal.style.display = "none"; });
    window.openUploadVideoModal = function() {
      let sel = document.getElementById("channelsDropdown");
      if (!sel.value) {
        alert("Please create or select a channel first.");
        return;
      }
      document.getElementById("videoFileInput").value = "";
      document.getElementById("videoTitleInput").value = "";
      document.getElementById("videoTagsInput").value = "";
      document.getElementById("videoVisibilitySelect").value = "public";
      document.getElementById("videoMonetizationSelect").value = "on";
      uploadVideoModal.style.display = "block";
    };
    document.getElementById("submitUploadVideoBtn").addEventListener("click", () => {
      let file = document.getElementById("videoFileInput").files[0];
      let title = document.getElementById("videoTitleInput").value.trim();
      let tags = document.getElementById("videoTagsInput").value.trim();
      let vis = document.getElementById("videoVisibilitySelect").value;
      let monet = document.getElementById("videoMonetizationSelect").value;
      let sel = document.getElementById("channelsDropdown");
      if (!sel.value) {
        alert("No channel selected!");
        return;
      }
      if (!file) {
        alert("Please choose a video file!");
        return;
      }
      if (!title) {
        alert("Video title cannot be empty!");
        return;
      }
      let fileURL = URL.createObjectURL(file);
      let cid = parseInt(sel.value);
      let channel = channels.find(ch => ch.id===cid);
      if (!channel) {
        alert("Invalid channel!");
        return;
      }
      let dateAdded = new Date().toLocaleDateString();
      videos.push({
        id: videoIdCounter++,
        channel: channel.name,
        title,
        fileURL,
        tags,
        visibility: vis,
        monetization: monet,
        likes: 0,
        dislikes: 0,
        removed: false,
        reason: "",
        date: dateAdded
      });
      addNotification("Video Uploaded", `New video "${title}" uploaded to channel ${channel.name}.`);
      uploadVideoModal.style.display = "none";
      renderVideos();
      updateHomeDataBoxes();
    });
    
    document.querySelectorAll('input[name="videoView"]').forEach(radio => {
      radio.addEventListener("change", () => {
        videoViewMode = radio.value;
        renderVideos();
      });
    });
    document.getElementById("channelsDropdown").addEventListener("change", () => {
      renderVideos();
    });
    
    window.likeVideo = function(vid, delta) {
      let v = videos.find(x => x.id===vid);
      if (!v || v.visibility==="removed") return;
      if (delta>0) {
        v.likes++;
        addNotification("Like", `You liked Video #${vid}`);
      } else {
        v.dislikes++;
        addNotification("Dislike", `You disliked Video #${vid}`);
      }
      renderVideos();
      updateHomeDataBoxes();
    };
    
    const editVideoModal = document.getElementById("editVideoModal");
    const closeEditVideoModal = document.getElementById("closeEditVideoModal");
    closeEditVideoModal.addEventListener("click", () => {
      editVideoModal.style.display = "none";
      currentVideoId = null;
    });
    window.openEditVideoModal = function(vid) {
      currentVideoId = vid;
      let v = videos.find(x => x.id===vid);
      if (!v) return;
      document.getElementById("editVideoFileInput").value = "";
      document.getElementById("editVideoTitleInput").value = v.title;
      document.getElementById("editVideoTagsInput").value = v.tags||"";
      document.getElementById("editVideoVisibilitySelect").value = v.visibility;
      document.getElementById("editVideoMonetizationSelect").value = v.monetization;
      editVideoModal.style.display = "block";
    };
    document.getElementById("submitEditVideoBtn").addEventListener("click", () => {
      let v = videos.find(x => x.id===currentVideoId);
      if (!v) return;
      let f = document.getElementById("editVideoFileInput").files[0];
      let newTitle = document.getElementById("editVideoTitleInput").value.trim();
      let newTags = document.getElementById("editVideoTagsInput").value.trim();
      let newVis = document.getElementById("editVideoVisibilitySelect").value;
      let newMonet = document.getElementById("editVideoMonetizationSelect").value;
      if (newTitle) v.title = newTitle;
      v.tags = newTags;
      v.visibility = newVis;
      v.monetization = newMonet;
      if (f) {
        let newURL = URL.createObjectURL(f);
        v.fileURL = newURL;
      }
      addNotification("Video Edit", `You edited Video #${v.id}`);
      editVideoModal.style.display = "none";
      currentVideoId = null;
      checkChannelRemoval(v.channel);
      renderVideos();
      updateHomeDataBoxes();
    });
    
    const reportVideoModal = document.getElementById("reportVideoModal");
    const closeReportVideoModal = document.getElementById("closeReportVideoModal");
    closeReportVideoModal.addEventListener("click", () => {
      reportVideoModal.style.display = "none";
      currentVideoId = null;
    });
    window.openReportVideoModal = function(vid) {
      currentVideoId = vid;
      document.getElementById("reportVideoReason").value = "";
      reportVideoModal.style.display = "block";
    };
    document.getElementById("submitReportVideoBtn").addEventListener("click", () => {
      let reason = document.getElementById("reportVideoReason").value.trim();
      if (!reason) {
        alert("Please provide a reason!");
        return;
      }
      let v = videos.find(x => x.id===currentVideoId);
      if (!v) return;
      v.visibility = "removed";
      v.removed = true;
      v.reason = reason;
      v.monetization = "ineligible";
      let ch = channels.find(ch => ch.name===v.channel);
      if (ch) { ch.strikes = (ch.strikes||0)+1; }
      addNotification("Report", `You reported Video #${v.id}. Reason: ${reason}`);
      reportVideoModal.style.display = "none";
      currentVideoId = null;
      checkChannelRemoval(v.channel);
      renderVideos();
      updateHomeDataBoxes();
    });
    
    const channelAppealModal = document.getElementById("channelAppealModal");
    const closeChannelAppealModal = document.getElementById("closeChannelAppealModal");
    const channelAppealMsg = document.getElementById("channelAppealMsg");
    closeChannelAppealModal.addEventListener("click", () => {
      channelAppealModal.style.display = "none";
      currentChannelId = null;
    });
    document.getElementById("submitChannelAppealBtn").addEventListener("click", () => {
      let c = channels.find(ch => ch.id===currentChannelId);
      if (!c) {
        channelAppealModal.style.display = "none";
        return;
      }
      let reason = document.getElementById("channelAppealReason").value.trim();
      if (!reason) {
        alert("Provide a reason for appeal!");
        return;
      }
      c.removed = false;
      c.removedReason = "";
      c.videosRemovedCount = 0;
      c.strikes = 0;
      channelAppealModal.style.display = "none";
      currentChannelId = null;
      addNotification("Channel Appeal", `Channel "${c.name}" was restored by appeal.`);
      loadChannelsDropdown();
      alert(`Channel ${c.name} has been restored!`);
    });
    function checkChannelRemoval(channelName) {
      let c = channels.find(ch => ch.name===channelName);
      if (!c) return;
      if (c.strikes>=5 && !c.removed) {
        c.removed = true;
        c.removedReason = "5 strikes reached => channel removed.";
        addNotification("Channel Removed", `Channel ${c.name} removed after 5 strikes.`);
        alert(`The Channel ${c.name} has been removed for having 5 strikes.\nYou can appeal in the channel so it will be restored.`);
        currentChannelId = c.id;
        channelAppealMsg.innerText = `The Channel "${c.name}" has been removed. Active Strikes: ${c.strikes} of 5. You can appeal now.`;
        channelAppealModal.style.display = "block";
        loadChannelsDropdown();
      }
    }
    window.openChannelWarningModal = function(channelId) {
      let ch = channels.find(ch => ch.id===channelId);
      if (!ch) return;
      let removedVideos = videos.filter(v => v.channel===ch.name && v.visibility==="removed");
      let content = `<p>Channel: ${ch.name}</p><p>Active Strikes: ${ch.strikes||0} of 5</p>`;
      if (removedVideos.length>0) {
        content += "<h3>Removed Videos:</h3><ul>";
        removedVideos.forEach(v => { content += `<li>${v.title}</li>`; });
        content += "</ul>";
      } else {
        content += "<p>No removed videos.</p>";
      }
      document.getElementById("channelWarningContent").innerHTML = content;
      document.getElementById("channelWarningModal").style.display = "block";
    };
    const closeChannelWarningModal = document.getElementById("closeChannelWarningModal");
    closeChannelWarningModal.addEventListener("click", () => {
      document.getElementById("channelWarningModal").style.display = "none";
    });
    
    /* ========== FULLSCREEN LOGIC ========== */
    const fsOverlay = document.getElementById("videoFullscreenOverlay");
    const fsVideo = document.getElementById("fullscreenVideo");
    const fsCloseBtn = document.getElementById("fullscreenCloseBtn");
    let fsDurationLabel = document.getElementById("fsDurationLabel");
    let fsCurrentTimeLabel = document.getElementById("fsCurrentTimeLabel");
    let fsTimeSlider = document.getElementById("fsTimeSlider");
    let fsPlayPauseBtn = document.getElementById("fsPlayPauseBtn");
    let fsAudioRange = document.getElementById("fsAudioRange");
    let fsSpeedSelect = document.getElementById("fsSpeedSelect");
    let fsQualitySelect = document.getElementById("fsQualitySelect");
    let currentVideoEl = null;
    
    window.openFullscreen = function(vid) {
      let v = videos.find(x => x.id===vid);
      if (!v || v.visibility==="removed") return;
      let localVideoEl = document.getElementById("videoEl"+vid);
      let fileURL = v.fileURL;
      if (localVideoEl) {
        currentVideoEl = localVideoEl;
        fileURL = localVideoEl.src;
      }
      fsVideo.src = fileURL;
      
      if (localVideoEl) {
        fsVideo.currentTime = localVideoEl.currentTime;
        fsVideo.playbackRate = localVideoEl.playbackRate;
        fsVideo.volume = localVideoEl.volume;
      }
      fsOverlay.style.display = "flex";
      fsVideo.addEventListener("loadedmetadata", initFsControls);
      if (fsVideo.readyState >= 1) initFsControls();
      addNotification("Fullscreen", `Opened fullscreen for Video #${vid}`);
    };
    function initFsControls(){
      fsTimeSlider.max = fsVideo.duration || 0;
      fsDurationLabel.textContent = formatFsTime(fsVideo.duration);
      fsTimeSlider.value = fsVideo.currentTime;
      fsCurrentTimeLabel.textContent = formatFsTime(fsVideo.currentTime);
    }
    function formatFsTime(sec){
      if (!sec || sec<0) sec=0;
      let m = Math.floor(sec/60), s = Math.floor(sec%60);
      return `${m}:${s<10?("0"+s):s}`;
    }
    fsVideo.addEventListener("timeupdate", () => {
      fsTimeSlider.value = fsVideo.currentTime;
      fsCurrentTimeLabel.textContent = formatFsTime(fsVideo.currentTime);
    });
    fsTimeSlider.addEventListener("input", () => {
      fsVideo.currentTime = parseFloat(fsTimeSlider.value);
    });
    fsPlayPauseBtn.addEventListener("click", () => {
      if (fsVideo.paused) {
        fsVideo.play();
        fsPlayPauseBtn.textContent = "Pause";
      } else {
        fsVideo.pause();
        fsPlayPauseBtn.textContent = "Play";
      }
    });
    fsVideo.addEventListener("play", () => { fsPlayPauseBtn.textContent = "Pause"; });
    fsVideo.addEventListener("pause", () => { fsPlayPauseBtn.textContent = "Play"; });
    fsAudioRange.addEventListener("input", () => {
      fsVideo.volume = parseInt(fsAudioRange.value)/100;
    });
    fsSpeedSelect.addEventListener("change", () => {
      fsVideo.playbackRate = parseFloat(fsSpeedSelect.value);
    });
    fsQualitySelect.addEventListener("change", () => {
      console.log("Fullscreen quality changed to:", fsQualitySelect.value);
    });
    fsCloseBtn.addEventListener("click", closeFullscreen);
    function closeFullscreen() {
      fsVideo.pause();
      if (currentVideoEl) {
        currentVideoEl.currentTime = fsVideo.currentTime;
        currentVideoEl.playbackRate = fsVideo.playbackRate;
        currentVideoEl.volume = fsVideo.volume;
      }
      fsOverlay.style.display = "none";
      currentVideoEl = null;
      fsVideo.src = "";
    }
    window.addEventListener("keydown", e => {
      if (e.key==="Escape") {
        if (fsOverlay.style.display==="flex") {
          closeFullscreen();
        }
      }
    });
    
    /* ========== 18) CREATE BUTTON TOGGLE ========== */
    const createButton = document.getElementById("createButton");
    const createMenu = document.getElementById("createMenu");
    createButton.addEventListener("click", e => {
      e.stopPropagation();
      createMenu.style.display = (createMenu.style.display==="block") ? "none" : "block";
    });
    document.addEventListener("click", e => {
      if (!createButton.contains(e.target) && !createMenu.contains(e.target)) {
        createMenu.style.display = "none";
      }
    });
    
    /* ========== 19) Filter Buttons + "More" logic ========== */
    const filterBtns = document.querySelectorAll(".filter-btn");
    const moreFiltersBtn = document.getElementById("moreFiltersBtn");
    const moreFiltersDropdown = document.getElementById("moreFiltersDropdown");
    
    // Click on a filter button sets "videoFilter" & re-renders
    filterBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        const f = btn.getAttribute("data-filter");
        videoFilter = f;  // "all", "removed", "public", "private", "moreLikes", "moreDislikes", "same", "moneyOn", "moneyOff"
        addNotification("Filter", `Filter changed to "${f}"`);
        renderVideos();
      });
    });
    
    // "More" icon toggles the dropdown
    moreFiltersBtn.addEventListener("click", e => {
      e.stopPropagation();
      moreFiltersDropdown.style.display = (moreFiltersDropdown.style.display==="block") ? "none" : "block";
    });
    document.addEventListener("click", e => {
      if (!moreFiltersBtn.contains(e.target) && !moreFiltersDropdown.contains(e.target)) {
        moreFiltersDropdown.style.display = "none";
      }
    });
    
    // We'll move certain filter buttons into the "More" dropdown at certain width breakpoints
    function handleVideoFilterVisibility() {
      // Approximate "zoom" by window.innerWidth
      let w = window.innerWidth;
      
      // Step 1: put them all back to normal
      filterBtns.forEach(b => b.classList.remove("hidden-filter-btn"));
      moreFiltersDropdown.innerHTML = "";
      
      // We'll hide them in ascending order if it gets narrower, just as an example:
      //  if w < 1399 => hide "moneyOff"
      //  if w < 1200 => hide "moneyOn"
      //  if w < 1130 => hide "same"
      //  if w < 1050  => hide "moreDislikes" & "moreLikes"
      //  if w < 399  => hide "private"
      //  if w < 399  => hide "removed"
      // (You can tweak these breakpoints to simulate 225%, 250%, etc.)

      function moveToMore(filterValue) {
        let b = document.querySelector(`.filter-btn[data-filter="${filterValue}"]`);
        if (b) {
          b.classList.add("hidden-filter-btn");
          let tmpBtn = document.createElement("button");
          tmpBtn.textContent = b.textContent;
          tmpBtn.setAttribute("data-filter", filterValue);
          tmpBtn.addEventListener("click", () => {
            videoFilter = filterValue;
            addNotification("Filter", `Filter changed to "${filterValue}"`);
            renderVideos();
            moreFiltersDropdown.style.display = "none";
          });
          moreFiltersDropdown.appendChild(tmpBtn);
        }
      }

      if (w < 1399) {
        moveToMore("moneyOff"); // ~225% or so
      }
      if (w < 1200) {
        moveToMore("moneyOn"); // ~250%
      }
      if (w < 1130) {
        moveToMore("same");    // ~275%
      }
      if (w < 1050) {
        moveToMore("moreDislikes");  // ~290%
        moveToMore("moreLikes");
      }
      if (w < 399) {
        moveToMore("private"); // ~310%
      }
      if (w < 399) {
        moveToMore("removed"); // ~325%
      }
    }
    window.addEventListener("resize", handleVideoFilterVisibility);
    
    /* ========== 19) Render Videos in List/Grid + Channel Filter + Filter Logic ========== */
    function renderVideos(){
      handleVideoFilterVisibility(); // whenever we render, we check if we need to hide some filter buttons
      let container = document.getElementById("videoList");
      let sel = document.getElementById("channelsDropdown");
      let cid = sel.value ? parseInt(sel.value) : null;
      let channelObj = cid ? channels.find(ch => ch.id===cid) : null;
      let channelName = channelObj ? channelObj.name : null;
      
      // If no channel is selected
      if (!channelName) {
        container.innerHTML = "<p>Select a channel above to view videos.</p>";
        return;
      }
      
      // Filter videos by channel
      let filtered = videos.filter(v => v.channel === channelName);

      // Now apply the "videoFilter"
      if (videoFilter==="removed") {
        filtered = filtered.filter(v => v.visibility==="removed");
      }
      else if (videoFilter==="public") {
        filtered = filtered.filter(v => v.visibility==="public");
      }
      else if (videoFilter==="private") {
        filtered = filtered.filter(v => v.visibility==="private");
      }
      else if (videoFilter==="moreLikes") {
        filtered = filtered.filter(v => v.likes > v.dislikes && v.visibility!=="removed");
      }
      else if (videoFilter==="moreDislikes") {
        filtered = filtered.filter(v => v.dislikes > v.likes && v.visibility!=="removed");
      }
      else if (videoFilter==="same") {
        filtered = filtered.filter(v => v.likes === v.dislikes && v.visibility!=="removed");
      }
      else if (videoFilter==="moneyOn") {
        filtered = filtered.filter(v => v.monetization==="on" && v.visibility!=="removed");
      }
      else if (videoFilter==="moneyOff") {
        filtered = filtered.filter(v => v.monetization==="off" && v.visibility!=="removed");
      }
      // if "all", we do nothing extra

      // If still empty
      if (filtered.length===0) {
        container.innerHTML = `<p>No videos found for the "${videoFilter}" filter under channel "${channelName}".</p>`;
        return;
      }

      let mode = videoViewMode; // "grid" or "list"
      function getVisibilityIcon(vis) {
        if (vis === "public") return "public";
        if (vis === "private") return "lock";
        if (vis === "removed") return "block";
        return "help";
      }
      function getMonetIcon(m) {
        if (m==="on") return "paid";
        if (m==="off") return "money_off";
        if (m==="ineligible") return "do_not_disturb_on";
        return "help";
      }

      if (mode==="grid") {
        container.classList.add("grid-mode");
        container.innerHTML = "";
        filtered.forEach(v => {
          let total = v.likes + v.dislikes;
          let lp = total>0 ? (v.likes/total)*100 : 0;
          let dp = total>0 ? (v.dislikes/total)*100 : 0;
          let removedFlag = (v.visibility==="removed");
          let progressBarHTML = "";
          if (settings.showDislike) {
            progressBarHTML = `
              <div style="background:#ddd; width:100%; height:10px; overflow:hidden;">
                <div style="background:#4caf50; width:${lp}%; height:100%; float:left;"></div>
                <div style="background:#f44336; width:${dp}%; height:100%; float:left;"></div>
              </div>
            `;
          } else {
            progressBarHTML = `
              <div style="background:#ddd; width:100%; height:10px;">
                <div style="background:#4caf50; width:${lp}%; height:100%;"></div>
              </div>
            `;
          }
          let visIcon = getVisibilityIcon(v.visibility);
          let monetIcon = getMonetIcon(v.monetization);
          container.innerHTML += `
            <div class="video-item">
              <h3 class="truncate" title="${v.title}">${v.title} ${removedFlag?"(Removed)":""}</h3>
              <p>Channel: ${v.channel}</p>
              <p>
                <span class="material-symbols-outlined">${visIcon}</span> ${v.visibility}
                &nbsp;|&nbsp;
                <span class="material-symbols-outlined">${monetIcon}</span> ${v.monetization}
              </p>
              <p>Date: ${v.date || "Unknown"}</p>
              <p>Likes: ${v.likes}, Dislikes: ${v.dislikes} (${formatPercent(lp)} positive)</p>
              ${progressBarHTML}
              <button class="btn" onclick="likeVideo(${v.id},1)">Like</button>
              <button class="btn" onclick="likeVideo(${v.id},-1)">Dislike</button>
              <button class="btn" onclick="openEditVideoModal(${v.id})">Edit</button>
              <button class="btn" onclick="openReportVideoModal(${v.id})">Report</button>
              <button class="btn" onclick="openFullscreen(${v.id})">Preview</button>
            </div>
          `;
        });
      } else {
        container.classList.remove("grid-mode");
        let html = `
          <table class="video-table">
            <thead>
              <tr>
                <th class="truncate">Video</th>
                <th class="truncate">Visibility</th>
                <th class="truncate">Monetization</th>
                <th class="truncate">Date</th>
                <th class="truncate">Likes vs Dislikes</th>
                <th class="truncate">Actions</th>
              </tr>
            </thead>
            <tbody>
        `;
        filtered.forEach(v => {
          let total = v.likes + v.dislikes;
          let lp = total>0 ? (v.likes/total)*100 : 0;
          let dp = total>0 ? (v.dislikes/total)*100 : 0;
          let progressBarHTML = "";
          if (settings.showDislike) {
            progressBarHTML = `
              <div style="background:#ddd; width:100%; height:10px; overflow:hidden;">
                <div style="background:#4caf50; width:${lp}%; height:100%; float:left;"></div>
                <div style="background:#f44336; width:${dp}%; height:100%; float:left;"></div>
              </div>
            `;
          } else {
            progressBarHTML = `
              <div style="background:#ddd; width:100%; height:10px;">
                <div style="background:#4caf50; width:${lp}%; height:100%;"></div>
              </div>
            `;
          }
          let visIcon = getVisibilityIcon(v.visibility);
          let monetIcon = getMonetIcon(v.monetization);
          
          html += `
            <tr>
              <td class="truncate" title="${v.title}">${v.title}${v.visibility==="removed"?" (Removed)":""}<br><small>Channel: ${v.channel}</small></td>
              <td class="truncate">
                <span class="material-symbols-outlined">${visIcon}</span> ${v.visibility}
              </td>
              <td class="truncate">
                <span class="material-symbols-outlined">${monetIcon}</span> ${v.monetization}
              </td>
              <td class="truncate">${v.date || "Unknown"}</td>
              <td class="truncate">
                Likes: ${v.likes}, Dislikes: ${v.dislikes} (${formatPercent(lp)} positive)<br/>
                ${progressBarHTML}
              </td>
              <td class="video-actions">
                <button class="btn" onclick="likeVideo(${v.id},1)">Like</button>
                <button class="btn" onclick="likeVideo(${v.id},-1)">Dislike</button>
                <button class="btn" onclick="openEditVideoModal(${v.id})">Edit</button>
                <button class="btn" onclick="openReportVideoModal(${v.id})">Report</button>
                <button class="btn" onclick="openFullscreen(${v.id})">Preview</button>
              </td>
            </tr>
          `;
        });
        html += `</tbody></table>`;
        container.innerHTML = html;
      }
    }
    
    /* ========== 20) Initialize on Page Load ========== */
    applySettings();
    updateLVD();
    updatePrivateCommentsList();
    updatePublicCommentsList();
    updateCheckHistory();
    updateHomeDataBoxes();
    renderPhotos();
    renderVideos(); // also calls handleVideoFilterVisibility
  </script>
</body>
</html>
